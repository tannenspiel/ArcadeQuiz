# Async Load Phaser ‚Äî Performance Optimization Plan

**–î–∞—Ç–∞:** 2026-02-03
**–°—Ç–∞—Ç—É—Å:** PLANNING
**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** –°—Ä–µ–¥–Ω–∏–π
**–¶–µ–ª—å:** –£–ª—É—á—à–∏—Ç—å FCP —Å 3.7s –¥–æ ~1.5s

---

## üìã –ö—Ä–∞—Ç–∫–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ

**–ü—Ä–æ–±–ª–µ–º–∞:** Phaser.js (1.2 MB) –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è —Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è, –±–ª–æ–∫–∏—Ä—É—è –≥–ª–∞–≤–Ω—ã–π –ø–æ—Ç–æ–∫ –∏ —É–≤–µ–ª–∏—á–∏–≤–∞—è First Contentful Paint (FCP).

**–†–µ—à–µ–Ω–∏–µ:** –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å React.lazy() –¥–ª—è –æ—Ç–ª–æ–∂–µ–Ω–Ω–æ–π –∑–∞–≥—Ä—É–∑–∫–∏ PhaserGame –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞, –ø–æ–∫–∞–∑—ã–≤–∞—è loading —ç–∫—Ä–∞–Ω –≤–æ –≤—Ä–µ–º—è –∑–∞–≥—Ä—É–∑–∫–∏.

**–†–ï–ê–õ–¨–ù–´–ô –†–ï–ó–£–õ–¨–¢–ê–¢:** FCP ~3.6s (–∏–∑–Ω–∞—á–∞–ª—å–Ω–æ 3.7s). Lazy load –¥–∞–ª **–º–∏–Ω–∏–º–∞–ª—å–Ω—ã–π —ç—Ñ—Ñ–µ–∫—Ç** ‚Äî –º–µ—Ç—Ä–∏–∫–∏ –ø–ª–∞–≤–∞—é—Ç –æ–∫–æ–ª–æ –∏—Å—Ö–æ–¥–Ω—ã—Ö –∑–Ω–∞—á–µ–Ω–∏–π.

**–í–ê–ñ–ù–û:** –†–µ–∞–ª—å–Ω–∞—è –ø—Ä–æ–±–ª–µ–º–∞ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –±—ã–ª–∞ –≤ **BrowserLogger side-effect import**, –∫–æ—Ç–æ—Ä—ã–π –±–ª–æ–∫–∏—Ä–æ–≤–∞–ª render. –ü–æ—Å–ª–µ fix: Performance Score: "!" ‚Üí 51, SEO: ‚Üí 100.

---

## üéØ –ó–∞—Ç—Ä–æ–Ω—É—Ç—ã–µ —Ñ–∞–π–ª—ã/–º–æ–¥—É–ª–∏

### –û—Å–Ω–æ–≤–Ω—ã–µ:
- `src/main.tsx` ‚Äî –¥–æ–±–∞–≤–∏—Ç—å React.lazy()
- `src/PhaserGame.tsx` ‚Äî –≤–æ–∑–º–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å fallback
- `src/ui/LoadingScreen.tsx` ‚Äî —Å–æ–∑–¥–∞—Ç—å –Ω–æ–≤—ã–π –∫–æ–º–ø–æ–Ω–µ–Ω—Ç

### –í—Ç–æ—Ä–∏—á–Ω—ã–µ:
- `public/sw.js` ‚Äî –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ Phaser
- `src/vite-env.d.ts` ‚Äî —Ç–∏–ø—ã –¥–ª—è lazy –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞
- –¢–µ—Å—Ç—ã ‚Äî `src/tests/unit/react/PhaserGame.test.tsx`

---

## üìù –®–∞–≥–∏ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

### Step 1: –°–æ–∑–¥–∞—Ç—å LoadingScreen –∫–æ–º–ø–æ–Ω–µ–Ω—Ç ‚úÖ

**–ó–∞–¥–∞—á–∞:** –°–æ–∑–¥–∞—Ç—å –≤–∏–∑—É–∞–ª—å–Ω–æ –ø—Ä–∏—è—Ç–Ω—ã–π loading —ç–∫—Ä–∞–Ω.

**–î–µ–π—Å—Ç–≤–∏—è:**
1. –°–æ–∑–¥–∞—Ç—å `src/ui/LoadingScreen.tsx`
2. –î–æ–±–∞–≤–∏—Ç—å –∞–Ω–∏–º–∞—Ü–∏—é –∑–∞–≥—Ä—É–∑–∫–∏ (—Å–ø–∏–Ω–Ω–µ—Ä –∏–ª–∏ Phaser-style)
3. –ü–æ–∫–∞–∑—ã–≤–∞—Ç—å —Ç–µ–∫—Å—Ç "–ó–∞–≥—Ä—É–∑–∫–∞ –∏–≥—Ä—ã..."

**–ö–æ–¥:**
```typescript
// src/ui/LoadingScreen.tsx
import React from 'react';
import './LoadingScreen.css';

const LoadingScreen: React.FC = () => {
  return (
    <div className="loading-screen">
      <div className="loading-spinner"></div>
      <p>–ó–∞–≥—Ä—É–∑–∫–∞ –∏–≥—Ä—ã...</p>
    </div>
  );
};

export default LoadingScreen;
```

**–§–∞–π–ª—ã:**
- `src/ui/LoadingScreen.tsx` (—Å–æ–∑–¥–∞—Ç—å)
- `src/ui/LoadingScreen.css` (—Å–æ–∑–¥–∞—Ç—å)

---

### Step 2: –û–±–µ—Ä–Ω—É—Ç—å PhaserGame –≤ React.lazy() ‚úÖ

**–ó–∞–¥–∞—á–∞:** –ò–∑–º–µ–Ω–∏—Ç—å –∏–º–ø–æ—Ä—Ç PhaserGame –Ω–∞ lazy.

**–î–µ–π—Å—Ç–≤–∏—è:**
1. –í `src/main.tsx` –æ–±–µ—Ä–Ω—É—Ç—å –∏–º–ø–æ—Ä—Ç –≤ `React.lazy()`
2. –î–æ–±–∞–≤–∏—Ç—å `Suspense` —Å fallback
3. –£–±–µ–¥–∏—Ç—å—Å—è —á—Ç–æ —Ç–∏–ø—ã –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã

**–ö–æ–¥:**
```typescript
// –ë—ã–ª–æ
import PhaserGame from './PhaserGame';

// –°—Ç–∞–ª–æ
const PhaserGame = lazy(() => import('./PhaserGame'));

function App() {
  return (
    <Suspense fallback={<LoadingScreen />}>
      <PhaserGame />
    </Suspense>
  );
}
```

**–§–∞–π–ª—ã:**
- `src/main.tsx`

---

### Step 3: –ü—Ä–æ–≤–µ—Ä–∏—Ç—å EventBus –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—é ‚úÖ

**–†–∏—Å–∫:** EventBus –º–æ–∂–µ—Ç –Ω–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å—Å—è –ø—Ä–∏ lazy load.

**–î–µ–π—Å—Ç–≤–∏—è:**
1. –ü—Ä–æ—á–∏—Ç–∞—Ç—å `src/game/EventBus.ts`
2. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∫–∞–∫ EventBus –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ PhaserGame.tsx
3. –ü—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ –¥–æ–±–∞–≤–∏—Ç—å –∑–∞—â–∏—Ç—É –æ—Ç undefined

**–¢–µ—Å—Ç:**
```typescript
// EventBusEmitter.ts ‚Äî –¥–æ–±–∞–≤–∏—Ç—å guard
if (typeof EventBus !== 'undefined' && EventBus.emit) {
  EventBus.emit(event, data);
}
```

**–§–∞–π–ª—ã:**
- `src/game/EventBus.ts`
- `src/PhaserGame.tsx`

---

### Step 4: –û–±–Ω–æ–≤–∏—Ç—å Service Worker –¥–ª—è –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è ‚úÖ

**–†–∏—Å–∫:** Phaser.js –º–æ–∂–µ—Ç –Ω–µ –∫—ç—à–∏—Ä–æ–≤–∞—Ç—å—Å—è –ø—Ä–∏ lazy load.

**–î–µ–π—Å—Ç–≤–∏—è:**
1. –ü—Ä–æ—á–∏—Ç–∞—Ç—å `public/sw.js`
2. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ Phaser.js –≤ —Å–ø–∏—Å–∫–µ precache
3. –ü—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ –¥–æ–±–∞–≤–∏—Ç—å –ø–∞—Ç—Ç–µ—Ä–Ω –¥–ª—è lazy chunks

**–ö–æ–¥:**
```javascript
// sw.js ‚Äî —É–±–µ–¥–∏—Ç—å—Å—è —á—Ç–æ Phaser –∫—ç—à–∏—Ä—É–µ—Ç—Å—è
workbox.precaching.precacheAndRoute([
  { url: '/assets/phaser-*.js', revision: null },
  { url: '/assets/index-*.js', revision: null },
]);
```

**–§–∞–π–ª—ã:**
- `public/sw.js`

---

### Step 5: –î–æ–±–∞–≤–∏—Ç—å TypeScript —Ç–∏–ø—ã –¥–ª—è lazy –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞ ‚úÖ

**–ó–∞–¥–∞—á–∞:** –ò—Å–ø—Ä–∞–≤–∏—Ç—å —Ç–∏–ø—ã –µ—Å–ª–∏ —Å–ª–æ–º–∞—é—Ç—Å—è.

**–î–µ–π—Å—Ç–≤–∏—è:**
1. –ü—Ä–æ—á–∏—Ç–∞—Ç—å `src/vite-env.d.ts`
2. –î–æ–±–∞–≤–∏—Ç—å —Ç–∏–ø –¥–ª—è lazy –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞ –µ—Å–ª–∏ –Ω—É–∂–Ω–æ

**–ö–æ–¥:**
```typescript
// vite-env.d.ts
declare module '*.tsx' {
  const content: React.FC<any>;
  export default content;
}
```

**–§–∞–π–ª—ã:**
- `src/vite-env.d.ts`

---

### Step 6: –û–±–Ω–æ–≤–∏—Ç—å —Ç–µ—Å—Ç—ã –¥–ª—è lazy –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞ ‚úÖ

**–ó–∞–¥–∞—á–∞:** –ê–¥–∞–ø—Ç–∏—Ä–æ–≤–∞—Ç—å —Ç–µ—Å—Ç—ã –¥–ª—è lazy loading.

**–î–µ–π—Å—Ç–≤–∏—è:**
1. –ü—Ä–æ—á–∏—Ç–∞—Ç—å `src/tests/unit/react/PhaserGame.test.tsx`
2. –î–æ–±–∞–≤–∏—Ç—å `act()` –∏ `waitFor` –¥–ª—è lazy –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞

**–ö–æ–¥:**
```typescript
// PhasingGame.test.tsx
import { act, waitFor } from '@testing-library/react';

test('renders game', async () => {
  await act(async () => {
    render(<App />);
  });
  await waitFor(() => {
    expect(screen.getByText(/Mysterious Portals/i)).toBeInTheDocument();
  });
});
```

**–§–∞–π–ª—ã:**
- `src/tests/unit/react/PhaserGame.test.tsx`

---

### Step 7: –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Å–µ—Ö –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö —Å–∏—Å—Ç–µ–º ‚úÖ

**–ó–∞–¥–∞—á–∞:** –£–±–µ–¥–∏—Ç—å—Å—è —á—Ç–æ –Ω–∏—á–µ–≥–æ –Ω–µ —Å–ª–æ–º–∞–ª–æ—Å—å.

**–ß–µ–∫-–ª–∏—Å—Ç:**
- [ ] –ò–≥—Ä–∞ –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ (–Ω–µ undefined)
- [ ] –ó–≤—É–∫–∏ –∏–≥—Ä–∞—é—Ç—Å—è (pickup coin, pickup key)
- [ ] –ö–æ–ª–ª–∏–∑–∏–∏ —Ä–∞–±–æ—Ç–∞—é—Ç (–∏–≥—Ä–æ–∫ —Å—Ç–∞–ª–∫–∏–≤–∞–µ—Ç—Å—è —Å –≤—Ä–∞–≥–æ–º)
- [ ] KeyQuestionModal –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç—Å—è –ø—Ä–∏ pickup key
- [ ] –ü–µ—Ä–µ—Ö–æ–¥ Level 1 ‚Üí Level 2 —Ä–∞–±–æ—Ç–∞–µ—Ç
- [ ] Service Worker –∫—ç—à–∏—Ä—É–µ—Ç Phaser
- [ ] –ö–æ–Ω—Å–æ–ª—å –±–µ–∑ –æ—à–∏–±–æ–∫

**–§–∞–π–ª—ã –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏:**
- `src/game/systems/CollisionSystem.ts`
- `src/game/systems/AudioManager.ts`
- `src/game/scenes/quiz/KeyQuizHandler.ts`
- `src/game/scenes/gameflow/LevelTransitionHandler.ts`

---

### Step 8: –ó–∞–ø—É—Å–∫ Lighthouse –∏ –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏—è ‚úÖ

**–ó–∞–¥–∞—á–∞:** –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ FCP —É–ª—É—á—à–∏–ª—Å—è.

**–î–µ–π—Å—Ç–≤–∏—è:**
1. –ü–µ—Ä–µ—Å–æ–±—Ä–∞—Ç—å: `npm run build`
2. –ó–∞–ø—É—Å—Ç–∏—Ç—å preview: `npm run preview`
3. –ó–∞–ø—É—Å—Ç–∏—Ç—å Lighthouse –Ω–∞ http://localhost:4173
4. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å FCP

**–†–ï–ê–õ–¨–ù–´–ï –ú–ï–¢–†–ò–ö–ò:**
- FCP: 3.7s ‚Üí **3.6s** (–º–∏–Ω–∏–º–∞–ª—å–Ω–æ–µ —É–ª—É—á—à–µ–Ω–∏–µ)
- Performance Score: **Error** ‚Üí **51** (–ø–æ—Å–ª–µ BrowserLogger fix)
- SEO Score: ‚Üí **100** (–ø–æ—Å–ª–µ robots.txt fix)

**–í–ê–ñ–ù–´–ï –ù–ê–•–û–î–ö–ò:**
1. **BrowserLogger side-effect** –±—ã–ª –≥–ª–∞–≤–Ω–æ–π –ø—Ä–æ–±–ª–µ–º–æ–π (—É—Ö—É–¥—à–∞–ª FCP –¥–æ 6.1s)
2. Lazy load Phaser –¥–∞–ª –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–π —ç—Ñ—Ñ–µ–∫—Ç
3. –ú–µ—Ç—Ä–∏–∫–∏ –ø–ª–∞–≤–∞—é—Ç –æ—Ç —Ç–µ—Å—Ç–∞ –∫ —Ç–µ—Å—Ç—É (~3.6-3.8s)

---

## üöß –£–∑–∫–∏–µ –º–µ—Å—Ç–∞ –∏ —Ä–∏—Å–∫–∏

| –†–∏—Å–∫ | –í–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å | –†–µ—à–µ–Ω–∏–µ |
|------|-----------|----------|
| EventBus undefined | –°—Ä–µ–¥–Ω—è—è | –î–æ–±–∞–≤–∏—Ç—å guard –≤ EventBusEmitter |
| Phaser container not found | –ù–∏–∑–∫–∞—è | React —Å–æ–∑–¥–∞—ë—Ç DOM –¥–æ lazy load |
| Service Worker –Ω–µ –∫—ç—à–∏—Ä—É–µ—Ç | –°—Ä–µ–¥–Ω—è—è | –û–±–Ω–æ–≤–∏—Ç—å sw.js |
| TypeScript –æ—à–∏–±–∫–∏ | –ù–∏–∑–∫–∞—è | –ò—Å–ø—Ä–∞–≤–∏—Ç—å —Ç–∏–ø—ã |
| –¢–µ—Å—Ç—ã –ø–∞–¥–∞—é—Ç | –°—Ä–µ–¥–Ω—è—è | –û–±–Ω–æ–≤–∏—Ç—å —Å act/waitFor |

---

## üìä –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏

**–û—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç** ‚Äî –∑–∞–¥–∞—á–∞ –Ω–µ–∑–∞–≤–∏—Å–∏–º–∞—è

---

## üìà –ö—Ä–∏—Ç–µ—Ä–∏–∏ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è

- [x] PhaserGame –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è —á–µ—Ä–µ–∑ React.lazy()
- [x] LoadingScreen –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è –≤–æ –≤—Ä–µ–º—è –∑–∞–≥—Ä—É–∑–∫–∏
- [x] –í—Å–µ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ —Å–∏—Å—Ç–µ–º—ã —Ä–∞–±–æ—Ç–∞—é—Ç (–∑–≤—É–∫–∏, –∫–æ–ª–ª–∏–∑–∏–∏, –º–æ–¥–∞–ª—ã)
- [x] –¢–µ—Å—Ç—ã –ø—Ä–æ—Ö–æ–¥—è—Ç
- [x] –ö–æ–Ω—Å–æ–ª—å –±–µ–∑ –æ—à–∏–±–æ–∫
- [x] **BrowserLogger side-effect —É–¥–∞–ª–µ–Ω** (–∫–ª—é—á–µ–≤–æ–π fix!)
- [x] **robots.txt –≤ public/** (SEO 100)

**–†–ï–ê–õ–¨–ù–´–ô –†–ï–ó–£–õ–¨–¢–ê–¢:** Performance Score 51, SEO 100, FCP ~3.6s

**–ü–†–ò–ú–ï–ß–ê–ù–ò–ï:** Lazy load –¥–∞–ª –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–π —ç—Ñ—Ñ–µ–∫—Ç –Ω–∞ FCP. –û—Å–Ω–æ–≤–Ω–æ–π gain –±—ã–ª –æ—Ç —É–¥–∞–ª–µ–Ω–∏—è BrowserLogger side-effect.

---

**–ê–≤—Ç–æ—Ä:** Claude AI
**–î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è:** 2026-02-03
