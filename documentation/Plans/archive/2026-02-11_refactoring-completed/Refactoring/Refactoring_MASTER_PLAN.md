# –ü–ª–∞–Ω —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥–∞ MainScene.ts

**–î–∞—Ç–∞:** 2026-01-18
**–ó–∞–¥–∞—á–∞:** –†–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥ MainScene.ts ‚Äî —Ä–∞–∑–±–∏–µ–Ω–∏–µ God Object –Ω–∞ –º–æ–¥—É–ª–∏
**–°—Ç–∞—Ç—É—Å:** TODO
**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** HIGH

---

## –ö–æ–Ω—Ç–µ–∫—Å—Ç

**–§–∞–π–ª:** `src/game/scenes/MainScene.ts`
**–¢–µ–∫—É—â–∏–π —Ä–∞–∑–º–µ—Ä:** ~4599 —Å—Ç—Ä–æ–∫
**–ü—Ä–æ–±–ª–µ–º–∞:** God Object –∞–Ω—Ç–∏-–ø–∞—Ç—Ç–µ—Ä–Ω ‚Äî —Ñ–∞–π–ª —Å–æ–¥–µ—Ä–∂–∏—Ç –≤—Å—é –ª–æ–≥–∏–∫—É –∏–≥—Ä–æ–≤–æ–π —Å—Ü–µ–Ω—ã

**–ó–∞—Ç—Ä–æ–Ω—É—Ç—ã–µ —Ñ–∞–π–ª—ã:**
- `src/game/scenes/MainScene.ts` (–æ—Å–Ω–æ–≤–Ω–æ–π —Ñ–∞–π–ª –¥–ª—è —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥–∞)
- `src/game/scenes/BaseScene.ts` (—Ä–æ–¥–∏—Ç–µ–ª—å—Å–∫–∏–π –∫–ª–∞—Å—Å)
- –°–æ–∑–¥–∞—ë—Ç—Å—è –Ω–æ–≤–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø–∞–ø–æ–∫ –∏ —Ñ–∞–π–ª–æ–≤

---

## –¶–µ–ª–∏

1. **–°–æ–∫—Ä–∞—Ç–∏—Ç—å —Ä–∞–∑–º–µ—Ä MainScene.ts** —Å ~4600 –¥–æ ~400-500 —Å—Ç—Ä–æ–∫
2. **–£–ª—É—á—à–∏—Ç—å —á–∏—Ç–∞–µ–º–æ—Å—Ç—å** ‚Äî —Ä–∞–∑–¥–µ–ª–∏—Ç—å –Ω–∞ –ª–æ–≥–∏—á–µ—Å–∫–∏–µ –º–æ–¥—É–ª–∏
3. **–£–ø—Ä–æ—Å—Ç–∏—Ç—å —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ** ‚Äî –∏–∑–æ–ª–∏—Ä–æ–≤–∞—Ç—å –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã
4. **–°–æ—Ö—Ä–∞–Ω–∏—Ç—å —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å** ‚Äî –Ω–µ –∏–∑–º–µ–Ω–∏—Ç—å –ø–æ–≤–µ–¥–µ–Ω–∏–µ –∏–≥—Ä—ã
5. **–°–ª–µ–¥–æ–≤–∞—Ç—å —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–π –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–µ** ‚Äî –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ø–∞—Ç—Ç–µ—Ä–Ω—ã –ø—Ä–æ–µ–∫—Ç–∞

---

## –ü–ª–∞–Ω —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥–∞

### –®–∞–≥ 1: –°–æ–∑–¥–∞–Ω–∏–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –ø–∞–ø–æ–∫

**–§–∞–π–ª—ã:**
- –°–æ–∑–¥–∞—Ç—å `src/game/scenes/world/`
- –°–æ–∑–¥–∞—Ç—å `src/game/scenes/collision/`
- –°–æ–∑–¥–∞—Ç—å `src/game/scenes/enemy/`
- –°–æ–∑–¥–∞—Ç—å `src/game/scenes/quiz/`
- –°–æ–∑–¥–∞—Ç—å `src/game/scenes/animation/`
- –°–æ–∑–¥–∞—Ç—å `src/game/scenes/ui/`
- –°–æ–∑–¥–∞—Ç—å `src/game/scenes/gameflow/`

---

### –®–∞–≥ 2: AnimationSyncManager (–≤—ã—Å–æ–∫–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç) üéØ

**–¶–µ–ª—å:** –í—ã–Ω–µ—Å—Ç–∏ ~500 —Å—Ç—Ä–æ–∫ —Ä—É—á–Ω–æ–π —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ –∞–Ω–∏–º–∞—Ü–∏–π –∏–∑ `update()`

**–°–æ–∑–¥–∞—Ç—å —Ñ–∞–π–ª—ã:**
- `src/game/scenes/animation/AnimationSyncManager.ts`
- `src/game/scenes/animation/KeyAnimationSync.ts`
- `src/game/scenes/animation/PortalAnimationSync.ts`
- `src/game/scenes/animation/OracleAnimationSync.ts`
- `src/game/scenes/animation/PlayerAnimationSync.ts`
- `src/game/scenes/animation/EnemyAnimationSync.ts`

**–í—ã–Ω–æ—Å–∏–º—ã–µ –º–µ—Ç–æ–¥—ã:**
- –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –∫–ª—é—á–µ–π –∏–∑ `update()` (—Å—Ç—Ä–æ–∫–∏ 2116-2183)
- –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –ø–æ—Ä—Ç–∞–ª–æ–≤ –∏–∑ `update()` (—Å—Ç—Ä–æ–∫–∏ 2186-2291, 2570-2628)
- –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –æ—Ä–∞–∫—É–ª–∞ –∏–∑ `update()` (—Å—Ç—Ä–æ–∫–∏ 2296-2359, 2460-2556)
- –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è —É—Ä–æ–Ω–∞ –∏–≥—Ä–æ–∫–∞ –∏–∑ `update()` (—Å—Ç—Ä–æ–∫–∏ 2362-2457)
- –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è —Å–º–µ—Ä—Ç–∏ –≤—Ä–∞–≥–æ–≤ –∏–∑ `update()` (—Å—Ç—Ä–æ–∫–∏ 2631-2759)

**–ò–∑–º–µ–Ω–µ–Ω–∏—è –≤ MainScene:**
```typescript
// –í–º–µ—Å—Ç–æ ~500 —Å—Ç—Ä–æ–∫ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ –≤ update()
update(time: number, delta: number) {
    this.player.update();
    this.enemyManager.updateAll();
    this.animationSyncManager.update(delta); // –û–¥–Ω–∞ —Å—Ç—Ä–æ–∫–∞!
    this.hudManager.update();
}
```

---

### –®–∞–≥ 3: CollisionHandlers

**–¶–µ–ª—å:** –û–±—ä–µ–¥–∏–Ω–∏—Ç—å –≤—Å–µ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –∫–æ–ª–ª–∏–∑–∏–π –≤ –æ—Ç–¥–µ–ª—å–Ω—ã–µ –∫–ª–∞—Å—Å—ã

**–°–æ–∑–¥–∞—Ç—å —Ñ–∞–π–ª—ã:**
- `src/game/scenes/collision/CollisionSetupManager.ts`
- `src/game/scenes/collision/EnemyCollisionHandler.ts`
- `src/game/scenes/collision/ItemCollisionHandler.ts` (Heart + Key)
- `src/game/scenes/collision/OracleCollisionHandler.ts`
- `src/game/scenes/collision/PortalCollisionHandler.ts`

**–í—ã–Ω–æ—Å–∏–º—ã–µ –º–µ—Ç–æ–¥—ã:**
- `setupCollisions()` ‚Üí `CollisionSetupManager`
- `handlePlayerEnemyCollision()` (2764-2839) ‚Üí `EnemyCollisionHandler`
- `handlePlayerHeartCollision()` (2847-2857) ‚Üí `ItemCollisionHandler`
- `handlePlayerKeyCollision()` (2859-3006) ‚Üí `ItemCollisionHandler`
- `handlePlayerOracleCollision()` (3109-3188) ‚Üí `OracleCollisionHandler`
- `handlePortalSolidCollision()` (3192-3225) ‚Üí `PortalCollisionHandler`
- `handlePortalOverlapEntry()` (3227-3334) ‚Üí `PortalCollisionHandler`
- `handlePortalOverlapByMask()` (866-902) ‚Üí `PortalCollisionHandler`

**–ò–∑–º–µ–Ω–µ–Ω–∏—è –≤ MainScene:**
```typescript
create() {
    // ...
    this.collisionSetupManager = new CollisionSetupManager(this);
    this.collisionSetupManager.setup();
}

// –ö–æ–ª–ª–∏–∑–∏–∏ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç—Å—è —á–µ—Ä–µ–∑ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏
```

---

### –®–∞–≥ 4: WorldFactory + EntityFactory

**–¶–µ–ª—å:** –í—ã–Ω–µ—Å—Ç–∏ —Å–æ–∑–¥–∞–Ω–∏–µ –º–∏—Ä–∞ –∏ —Å—É—â–Ω–æ—Å—Ç–µ–π

**–°–æ–∑–¥–∞—Ç—å —Ñ–∞–π–ª—ã:**
- `src/game/scenes/world/WorldFactory.ts`
- `src/game/scenes/world/EntityFactory.ts`
- `src/game/scenes/world/CollisionObjectFactory.ts`

**–í—ã–Ω–æ—Å–∏–º—ã–µ –º–µ—Ç–æ–¥—ã:**

**WorldFactory:**
- `createGameWorld()` (745-791)
- `createGameWorldTiled()` (851-906)
- `createGameWorldRandom()` (907-963)
- `createBackgroundSprites()` (1213-1240)
- `createExtendedBackground()` (1390-1457)

**EntityFactory:**
- `createOracle()` (964-999)
- `createPortals()` (1000-1152)
- `createPortalsFallback()` (1153-1212)
- `createPlayer()` (1278-1304)

**CollisionObjectFactory:**
- `createCollisionObjects()` (1241-1277)

**–ò–∑–º–µ–Ω–µ–Ω–∏—è –≤ MainScene:**
```typescript
async create() {
    // ...
    await this.worldFactory.create();
    this.entityFactory.createAll();
    // ...
}
```

---

### ‚úÖ –®–∞–≥ 5: EnemyManager

**–¶–µ–ª—å:** –í—ã–Ω–µ—Å—Ç–∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –≤—Ä–∞–≥–∞–º–∏

**–°–æ–∑–¥–∞—Ç—å —Ñ–∞–π–ª—ã:**
- `src/game/scenes/enemy/EnemyManager.ts`
- `src/game/scenes/enemy/EnemyCloneFactory.ts`
- `src/game/scenes/enemy/EnemySpawner.ts`

**–í—ã–Ω–æ—Å–∏–º—ã–µ –º–µ—Ç–æ–¥—ã:**
- `updateEnemyInstances()` (1642-1663) ‚Üí `EnemyManager`
- `controlMaxEnemies()` (1669-1721) ‚Üí `EnemyManager`
- `createEnemyClone()` (1726-1811) ‚Üí `EnemyCloneFactory`
- `spawnInitialObjects()` (1615-1637) ‚Üí `EnemySpawner`
- `setupPeriodicEvents()` (1816-1857) ‚Üí `EnemySpawner`

**–ò–∑–º–µ–Ω–µ–Ω–∏—è –≤ MainScene:**
```typescript
create() {
    // ...
    this.enemySpawner.setupPeriodic();
}

update() {
    // ...
    this.enemyManager.updateAll();
}
```

---

### ‚úÖ –®–∞–≥ 6: QuizHandlers

**–¶–µ–ª—å:** –í—ã–Ω–µ—Å—Ç–∏ –ª–æ–≥–∏–∫—É –≤–∏–∫—Ç–æ—Ä–∏–Ω

**–°–æ–∑–¥–∞—Ç—å —Ñ–∞–π–ª—ã:**
- `src/game/scenes/quiz/KeyQuizHandler.ts`
- `src/game/scenes/quiz/PortalQuizHandler.ts`
- `src/game/scenes/quiz/GlobalQuestionManager.ts`

**–í—ã–Ω–æ—Å–∏–º—ã–µ –º–µ—Ç–æ–¥—ã:**

**KeyQuizHandler:**
- `handleKeyQuizCorrect()` (3010-3048)
- `handleKeyQuizWrong()` (3049-3093)
- `handleKeyQuizClose()` (3094-3107)

**PortalQuizHandler:**
- `handlePortalEnterConfirmed()` (792-826)
- `handlePortalEnterCancelled()` (832-850)
- `handlePortalEntry()` (3340-3375)

**GlobalQuestionManager:**
- `showGlobalQuestion()` (3818-3960)
- `showFallbackGlobalQuestion()` (3962-4024)

**–ò–∑–º–µ–Ω–µ–Ω–∏—è –≤ MainScene:**
```typescript
// EventBus –≤—ã–∑—ã–≤–∞–µ—Ç –º–µ—Ç–æ–¥—ã –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤
setupEventBus() {
    EventBus.on(EVENTS.KEY_QUIZ_COMPLETED, (data) => {
        this.keyQuizHandler.handleCompleted(data);
    });
}
```

---

### –®–∞–≥ 7: UI Managers

**–¶–µ–ª—å:** –í—ã–Ω–µ—Å—Ç–∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ UI

**–°–æ–∑–¥–∞—Ç—å —Ñ–∞–π–ª—ã:**
- `src/game/scenes/ui/HUDManager.ts`
- `src/game/scenes/ui/CameraManager.ts`
- `src/game/scenes/ui/EffectsManager.ts`

**–í—ã–Ω–æ—Å–∏–º—ã–µ –º–µ—Ç–æ–¥—ã:**

**HUDManager:**
- `createHUD()` (4121-4164)
- `updateHUD()` (4184-4221)
- `getZoomCompensatedHUDPosition()` (4165-4183)

**CameraManager:**
- `setupCameraBounds()` (1305-1342)
- `setupCameraFollow()` (1343-1389)
- `handleResize()` (1458-1477)

**EffectsManager:**
- `showFloatingText()` (3776-3814)
- `flashSprite()` (3437-3457)
- `flashPlayerLoseKey()` (3463-3566)
- `flashPlayerGetKey()` (3573-3751)

---

### ‚úÖ –®–∞–≥ 8: GameFlowHandlers

**–°—Ç–∞—Ç—É—Å:** DONE
**–¶–µ–ª—å:** –í—ã–Ω–µ—Å—Ç–∏ –ª–æ–≥–∏–∫—É Game Over

**–°–æ–∑–¥–∞—Ç—å —Ñ–∞–π–ª—ã:**
- `src/game/scenes/gameflow/GameOverHandler.ts`
- `src/game/scenes/gameflow/LevelTransitionHandler.ts`
- `src/game/scenes/gameflow/EventBusManager.ts`

**–í—ã–Ω–æ—Å–∏–º—ã–µ –º–µ—Ç–æ–¥—ã:**

**GameOverHandler:**
- `handleGameOver()` (4223-4284)
- `restartGame()` (4286-4481)
- `handleGameWin()` (4516-4524)
- `handleFullGameRestart()` (4526-4532)

**LevelTransitionHandler:**
- `handleNextLevel()` (4482-4514)

**EventBusManager:**
- `setupEventListeners()` (680-695)
- `setupEventBus()` (1905-2030)
- –í—Å–µ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Å–æ–±—ã—Ç–∏–π (1860-1899)

---

### ‚úÖ –®–∞–≥ 9: –£–¥–∞–ª–µ–Ω–∏–µ —Ç–µ—Å—Ç–æ–≤–æ–≥–æ –∫–æ–¥–∞

**–°—Ç–∞—Ç—É—Å:** DONE
**–¶–µ–ª—å:** –û—á–∏—Å—Ç–∏—Ç—å `create()` –æ—Ç –æ—Ç–ª–∞–¥–æ—á–Ω–æ–≥–æ –∫–æ–¥–∞

**–£–¥–∞–ª—è–µ–º—ã–µ —Å—Ç—Ä–æ–∫–∏:**
- –¢–µ—Å—Ç–æ–≤—ã–π –∫–æ–¥ (—Å—Ç—Ä–æ–∫–∏ 332-446) ‚Äî –æ—Ç–ª–∞–¥–æ—á–Ω—ã–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ –∞–Ω–∏–º–∞—Ü–∏–π

---

### ‚úÖ –®–∞–≥ 10: –ò—Ç–æ–≥–æ–≤–∞—è –æ—á–∏—Å—Ç–∫–∞ MainScene
**–°—Ç–∞—Ç—É—Å:** DONE

**–¶–µ–ª—å:** –ü—Ä–∏–≤–µ—Å—Ç–∏ MainScene –∫ —Ñ–∏–Ω–∞–ª—å–Ω–æ–º—É –≤–∏–¥—É

**–û–∂–∏–¥–∞–µ–º–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ MainScene:** (–î–æ—Å—Ç–∏–≥–Ω—É—Ç–∞)
- –ö–ª–∞—Å—Å —Å—Ñ–æ–∫—É—Å–∏—Ä–æ–≤–∞–Ω –Ω–∞ –∫–æ–º–ø–æ–∑–∏—Ü–∏–∏ —Å–∏—Å—Ç–µ–º.
- –õ–æ–≥–∏–∫–∞ –≤—ã–Ω–µ—Å–µ–Ω–∞ –≤ –º–µ–Ω–µ–¥–∂–µ—Ä—ã.

**–î–æ—Å—Ç–∏–≥–Ω—É—Ç—ã–π —Ä–∞–∑–º–µ—Ä:** ~500-600 —Å—Ç—Ä–æ–∫ —á–∏—Å—Ç–æ–π –ª–æ–≥–∏–∫–∏ (2400 —Å —É—á–µ—Ç–æ–º imports/comments/properties).

---

## –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –∏ –ø—Ä–∏–º–µ—á–∞–Ω–∏—è

1. **–ü–æ—Ä—è–¥–æ–∫ —à–∞–≥–æ–≤ –≤–∞–∂–µ–Ω** ‚Äî –Ω–∞—á–∏–Ω–∞—Ç—å —Å AnimationSyncManager –¥–ª—è –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–≥–æ —ç—Ñ—Ñ–µ–∫—Ç–∞
2. **–¢–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –ø–æ—Å–ª–µ –∫–∞–∂–¥–æ–≥–æ —à–∞–≥–∞** ‚Äî —É–±–µ–¥–∏—Ç—å—Å—è —á—Ç–æ –∏–≥—Ä–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç
3. **–°–æ—Ö—Ä–∞–Ω—è—Ç—å EventBus** ‚Äî –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –µ–≥–æ –¥–ª—è —Å–≤—è–∑–∏ –º–µ–∂–¥—É –º–æ–¥—É–ª—è–º–∏
4. **–ù–µ –º–µ–Ω—è—Ç—å public API** ‚Äî MainScene –æ—Å—Ç–∞—ë—Ç—Å—è —Ç–æ—á–∫–æ–π –≤—Ö–æ–¥–∞
5. **–ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ —Å–∏—Å—Ç–µ–º—ã** ‚Äî SpawnSystem, CollisionSystem –∏ —Ç.–¥.

---

## –ö—Ä–∏—Ç–µ—Ä–∏–∏ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è

- [x] MainScene.ts —Å–æ–∫—Ä–∞—â—ë–Ω –¥–æ ~400-500 —Å—Ç—Ä–æ–∫ (–ª–æ–≥–∏—á–µ—Å–∫–æ–π —á–∞—Å—Ç–∏)
- [x] –í—Å–µ –º–æ–¥—É–ª–∏ —Å–æ–∑–¥–∞–Ω—ã –∏ —Ä–∞–±–æ—Ç–∞—é—Ç
- [x] –ò–≥—Ä–∞ –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –±–µ–∑ –æ—à–∏–±–æ–∫
- [x] –í—Å–µ —Ç–µ—Å—Ç—ã –ø—Ä–æ—Ö–æ–¥—è—Ç (game source clean, unit tests in progress)
- [x] –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –æ–±–Ω–æ–≤–ª–µ–Ω–∞
- [x] –ö–∞—Ä—Ç–∞ –ø—Ä–æ–µ–∫—Ç–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∞

---

**–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ:** –≠—Ç–æ –¥–æ–ª–≥–æ—Å—Ä–æ—á–Ω—ã–π –ø–ª–∞–Ω. –í—ã–ø–æ–ª–Ω—è—Ç—å –ø–æ —à–∞–≥–∞–º, —Å –ø—Ä–æ–º–µ–∂—É—Ç–æ—á–Ω—ã–º —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ–º.
