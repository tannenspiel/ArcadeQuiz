# Анализ прототипа проекта ArcadeQuiz

**Дата анализа:** 2024  
**Версия прототипа:** 1.0.0  
**Расположение:** `prototype/`

## Общее описание

Прототип представляет собой полнофункциональную игру "Mysterious Portals" (Загадочные Порталы), реализованную на стеке **React 19.2.0 + Phaser 3.90.0 + TypeScript**. Это top-down аркада с элементами викторины, где игрок собирает ключи, отвечает на вопросы и ищет правильный портал для победы.

## Архитектура прототипа

### Технологический стек

- **Frontend Framework:** React 19.2.0
- **Игровой движок:** Phaser 3.90.0
- **Язык:** TypeScript 5.8.2
- **Сборщик:** Vite 6.2.0
- **Стилизация:** Tailwind CSS (inline классы)

### Структура файлов

```
prototype/
├── App.tsx                    # Главный React компонент
├── index.tsx                  # Точка входа React
├── index.html                 # HTML шаблон
├── package.json               # Зависимости проекта
├── vite.config.ts             # Конфигурация Vite
├── tsconfig.json              # Конфигурация TypeScript
├── constants.ts               # Игровые константы
├── types.ts                   # TypeScript типы
├── components/                # React компоненты UI
│   ├── UIOverlay.tsx          # HUD интерфейс
│   ├── QuizModal.tsx          # Модальное окно викторины
│   └── GameOverModal.tsx      # Модальное окно окончания игры
└── game/                      # Phaser игровая логика
    ├── EventBus.ts            # Система событий React-Phaser
    ├── PhaserGame.tsx         # React обертка для Phaser
    └── scenes/
        └── MainScene.ts       # Основная игровая сцена (740 строк)
```

## Ключевые компоненты

### 1. EventBus (game/EventBus.ts)

Простая система событий на базе Phaser.Events.EventEmitter для коммуникации между React и Phaser.

**События:**
- `update-hud` - обновление HUD (health, runes, altarActive)
- `show-quiz` - показ модального окна викторины
- `quiz-completed` - завершение викторины (correct, context)
- `game-over` - окончание игры (win/lose)
- `restart-game` - перезапуск игры

### 2. MainScene (game/scenes/MainScene.ts)

Основная игровая сцена содержит всю игровую логику. Размер файла: **740 строк кода**.

#### Игровые объекты:

**Группы объектов:**
- `enemies` - обычные враги (красные круги)
- `chasers` - преследующие враги (фиолетовые круги)
- `hearts` - сердечки для восстановления здоровья
- `keys` - ключи (ранее runes) для активации Оракула и порталов (зеленые треугольники в прототипе)
- `portals` - порталы для перехода на следующий уровень

**Отдельные объекты:**
- `player` - игрок (синий квадрат)
- `oracle` - Оракул (ранее altar) в центре карты
- `keyGraphics` - визуализация собранных ключей вокруг игрока

#### Игровые механики:

1. **Движение игрока:**
   - Управление стрелками или WASD
   - Скорость: 250 пикселей/сек
   - Камера следует за игроком с плавностью 0.08

2. **Система здоровья:**
   - Максимум: 3 жизни
   - Восстановление через сердечки
   - Потеря жизни при столкновении с врагом без ключей

3. **Система ключей:**
   - Максимум: 3 ключа в инвентаре
   - Получение через мини-викторины
   - Защита от врагов (1 ключ = 1 враг)
   - Визуализация защитных колец вокруг игрока

4. **Враги:**
   - **Normal enemies:** Скорость 80, движутся случайно, не преследуют
   - **Chaser enemies:** Скорость 45, преследуют игрока в радиусе 250px
   - Спавн каждые 6 секунд (максимум 15 врагов)
   - Отскакивают от границ мира

5. **Оракул (ранее Алтарь):**
   - Расположен в центре карты
   - Требует 3 ключа для активации
   - После активации показывает глобальный вопрос
   - Активирует возможность открытия порталов

6. **Порталы:**
   - 3 портала на карте (A, B, C)
   - Требуют 3 ключа каждый для открытия
   - Один портал правильный (Mars), два неправильных (Venus, Jupiter)
   - При входе в правильный портал - победа
   - При входе в неправильный - поражение

7. **Предметы:**
   - **Сердечки:** Спавн каждые 24 секунды (максимум 10)
   - **Ключи:** Спавн каждые 24 секунды (максимум 12)

#### Визуальные эффекты:

- `flashSprite()` - мигание спрайта при событиях
- `triggerRingLossEffect()` - эффект потери защитного кольца
- `showFloatingText()` - всплывающий текст
- Анимации активации порталов (зеленое мигание)

### 3. React компоненты

#### UIOverlay.tsx
HUD интерфейс с отображением:
- Здоровье (3 сердечка)
- Количество ключей
- Глобальный вопрос (после активации алтаря)
- Подсказки для игрока

#### QuizModal.tsx
Модальное окно викторины с двумя темами:
- **Зеленая тема** - для ключей (KEY GUARDIAN QUIZ)
- **Голубая тема** - для порталов (PORTAL CONNECTION)

#### GameOverModal.tsx
Модальное окно окончания игры:
- Победа (синяя тема)
- Поражение (красная тема)
- Кнопка перезапуска

### 4. Константы (constants.ts)

**Размеры карты:**
- MAP_WIDTH: 2000px
- MAP_HEIGHT: 2000px
- VIEWPORT_WIDTH: 800px
- VIEWPORT_HEIGHT: 600px

**Скорости:**
- PLAYER_SPEED: 250
- ENEMY_SPEED: 80
- CHASER_SPEED: 45

**Игровые данные:**
- MINI_QUIZZES: 6 простых вопросов
- GLOBAL_QUESTION: "Which planet is known as the 'Red Planet'?"
- PORTALS_DATA: 3 портала с ответами (Venus, Mars, Jupiter)

### 5. Типы (types.ts)

Определены интерфейсы:
- `QuizData` - данные викторины
- `GameState` - состояние игры
- `EntityType` - enum типов сущностей
- `PortalConfig` - конфигурация портала

## Игровой процесс

### Фазы игры:

1. **Исследование и сбор:**
   - Игрок перемещается по большой карте (2000x2000)
   - Собирает сердечки для здоровья
   - Собирает ключи через мини-викторины
   - Избегает врагов

2. **Активация Оракула:**
   - Игрок приносит 3 ключа к Оракулу в центре
   - Оракул активируется и показывает глобальный вопрос
   - Становится возможным открытие порталов

3. **Открытие порталов:**
   - Игрок приносит по 3 ключа к каждому порталу
   - Портал открывается и показывает свой ответ
   - Игрок должен выбрать правильный портал

4. **Финал:**
   - Вход в правильный портал → Победа
   - Вход в неправильный портал → Поражение
   - Потеря всех жизней → Поражение

## Технические особенности

### Генерация текстур

Все текстуры генерируются программно в методе `generateTextures()`:
- Простые геометрические формы
- Цветовая кодировка для разных типов объектов
- Размеры: 32x32 для большинства, 64x64 для алтаря, 80x80 для порталов

### Система коллизий

- **Collider** - для твердых объектов (закрытые порталы, враги)
- **Overlap** - для сбора предметов и входа в порталы
- Умная обработка порталов: закрытые = твердые, открытые = проходимые

### Управление состоянием

- Игровое состояние хранится в MainScene
- UI состояние в React компонентах
- Синхронизация через EventBus

### Оптимизация спавна

- Система `occupiedZones` для безопасного размещения объектов
- Проверка расстояния от игрока (минимум 300px)
- Ограничение максимального количества объектов

## Готовность к миграции

### ✅ Полностью готово:

1. **Архитектура:**
   - Четкое разделение React и Phaser
   - EventBus для коммуникации
   - Типизация TypeScript

2. **Игровая логика:**
   - Все механики реализованы
   - Система коллизий работает
   - Визуальные эффекты на месте

3. **UI компоненты:**
   - Все модальные окна готовы
   - HUD интерфейс функционален
   - Стилизация через Tailwind

### ⚠️ Требует доработки:

1. **Структура проекта:**
   - Нужна реорганизация под целевую структуру
   - Вынос констант и типов в отдельные модули
   - Оптимизация импортов

2. **Код:**
   - MainScene.ts слишком большой (740 строк)
   - Можно вынести логику в отдельные классы
   - Генерация текстур должна быть в отдельном модуле

3. **Ассеты:**
   - Текстуры генерируются программно
   - Нет реальных изображений
   - Нет звуковых эффектов

## Соответствие GameDescription.md

### ✅ Реализовано:

- ✅ Большой исследовательский мир (2000x2000)
- ✅ Камера следует за игроком
- ✅ Сбор ключей через мини-викторины
- ✅ Система защиты ключами от врагов
- ✅ Оракул для активации порталов
- ✅ Три портала с вариантами ответов
- ✅ Система здоровья и сердечек
- ✅ Два типа врагов (normal и chaser)

### ⚠️ Частично реализовано:

- Вариант А (глобальный вопрос) - реализован
- Вариант Б (портал-утверждение) - не реализован
- Вариант В (сложная викторина у портала) - не реализован

**Примечание:** В прототипе реализован только вариант А из GameDescription.md. Варианты Б и В можно добавить для других уровней.

## Рекомендации по миграции

### Приоритет 1 (Критично):
1. Перенести EventBus.ts
2. Перенести MainScene.ts (с рефакторингом)
3. Перенести константы и типы
4. Перенести React компоненты

### Приоритет 2 (Важно):
1. Реорганизовать структуру проекта
2. Вынести генерацию текстур в отдельный модуль
3. Оптимизировать код MainScene

### Приоритет 3 (Желательно):
1. Добавить реальные текстуры
2. Добавить звуковые эффекты
3. Реализовать варианты Б и В порталов

## Заключение

Прототип представляет собой **полнофункциональную игру** с четкой архитектурой и реализованными основными механиками. Код хорошо структурирован, типизирован и готов к миграции в основную структуру проекта. Основная задача миграции - реорганизация файлов и оптимизация кода, а не переписывание функциональности.

**Оценка готовности:** 85%  
**Основные задачи:** Реорганизация структуры, оптимизация кода, добавление ассетов



