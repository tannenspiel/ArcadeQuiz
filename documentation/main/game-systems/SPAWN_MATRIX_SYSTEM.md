# –ú–∞—Ç—Ä–∏—á–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ –ø–æ–∑–∏—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è –æ–±—ä–µ–∫—Ç–æ–≤

**–í–µ—Ä—Å–∏—è:** 1.1  
**–î–∞—Ç–∞:** 2025-12-08  
**–ü–æ—Å–ª–µ–¥–Ω–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ:** 2025-01-XX  
**–°—Ç–∞—Ç—É—Å:** ‚úÖ –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ –∏ –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–æ

## –û–±–∑–æ—Ä

–ú–∞—Ç—Ä–∏—á–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ –ø–æ–∑–∏—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è (`SpawnMatrix`) –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç –±–µ–∑–æ–ø–∞—Å–Ω—ã–π —Å–ø–∞–≤–Ω –æ–±—ä–µ–∫—Ç–æ–≤ –Ω–∞ –∫–∞—Ä—Ç–µ –±–µ–∑ –ø–µ—Ä–µ—Å–µ—á–µ–Ω–∏–π. –ö–∞—Ä—Ç–∞ —Ä–∞–∑–¥–µ–ª–µ–Ω–∞ –Ω–∞ —Å–µ—Ç–∫—É —è—á–µ–µ–∫, –∫–∞–∂–¥–∞—è –∏–∑ –∫–æ—Ç–æ—Ä—ã—Ö –æ—Ç—Å–ª–µ–∂–∏–≤–∞–µ—Ç —Å–≤–æ—é –∑–∞–Ω—è—Ç–æ—Å—Ç—å.

## –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

### –û—Å–Ω–æ–≤–Ω—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã

1. **`SpawnMatrix`** (`src/game/systems/SpawnMatrix.ts`)
   - –£–ø—Ä–∞–≤–ª—è–µ—Ç –º–∞—Ç—Ä–∏—Ü–µ–π –∑–∞–Ω—è—Ç–æ—Å—Ç–∏ —è—á–µ–µ–∫
   - –ö–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ—Ç –º–∏—Ä–æ–≤—ã–µ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã –≤ –∏–Ω–¥–µ–∫—Å—ã —è—á–µ–µ–∫ –∏ –æ–±—Ä–∞—Ç–Ω–æ
   - –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –∏ –∑–∞–Ω–∏–º–∞–µ—Ç –ø—Ä—è–º–æ—É–≥–æ–ª—å–Ω—ã–µ –æ–±–ª–∞—Å—Ç–∏ —è—á–µ–µ–∫

2. **`SpawnSystem`** (`src/game/systems/SpawnSystem.ts`)
   - –ò—Å–ø–æ–ª—å–∑—É–µ—Ç `SpawnMatrix` –¥–ª—è —Ä–∞–∑–º–µ—â–µ–Ω–∏—è –æ–±—ä–µ–∫—Ç–æ–≤
   - –ü—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç –º–µ—Ç–æ–¥—ã —Å–ø–∞–≤–Ω–∞ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —Ç–∏–ø–∞ –æ–±—ä–µ–∫—Ç–∞
   - –ì–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç –ø—Ä–∞–≤–∏–ª—å–Ω–æ–µ –ø–æ–∑–∏—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –æ–±—ä–µ–∫—Ç–æ–≤ –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω–æ –∑–∞–Ω—è—Ç—ã—Ö —è—á–µ–µ–∫

## –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –º–∞—Ç—Ä–∏—Ü—ã

### –†–∞–∑–º–µ—Ä—ã

- **–†–∞–∑–º–µ—Ä –∫–∞—Ä—Ç—ã:** 2048√ó2048 –≤–∏—Ä—Ç—É–∞–ª—å–Ω—ã—Ö –ø–∏–∫—Å–µ–ª–µ–π
- **–†–∞–∑–º–µ—Ä —è—á–µ–π–∫–∏:** 64√ó64 –ø–∏–∫—Å–µ–ª–µ–π
- **–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —è—á–µ–µ–∫:** 32√ó32 (1024 —è—á–µ–π–∫–∏)

### –¢–∏–ø—ã –∑–∞–Ω—è—Ç–æ—Å—Ç–∏

```typescript
type CellOccupancyType = 'free' | 'permanent' | 'item' | 'enemy';
```

- **`'free'`** ‚Äî —è—á–µ–π–∫–∞ —Å–≤–æ–±–æ–¥–Ω–∞
- **`'permanent'`** ‚Äî –∑–∞–Ω—è—Ç–∞ –ø–æ—Å—Ç–æ—è–Ω–Ω—ã–º –æ–±—ä–µ–∫—Ç–æ–º (–ø–æ—Ä—Ç–∞–ª—ã, –æ—Ä–∞–∫—É–ª, –∫—É—Å—Ç—ã)
- **`'item'`** ‚Äî –∑–∞–Ω—è—Ç–∞ –ø—Ä–µ–¥–º–µ—Ç–æ–º (–∫–ª—é—á–∏, —Å–µ—Ä–¥–µ—á–∫–∏)
- **`'enemy'`** ‚Äî –∑–∞–Ω—è—Ç–∞ –≤—Ä–∞–≥–æ–º

### –ü—Ä–∞–≤–∏–ª–∞ –ø–µ—Ä–µ–∑–∞–ø–∏—Å–∏

- –í—Ä–∞–≥–∏ –º–æ–≥—É—Ç –ø–µ—Ä–µ–∑–∞–ø–∏—Å—ã–≤–∞—Ç—å –ø—Ä–µ–¥–º–µ—Ç—ã (`'item'` ‚Üí `'enemy'`)
- –í—Ä–∞–≥–∏ **–Ω–µ –º–æ–≥—É—Ç** –ø–µ—Ä–µ–∑–∞–ø–∏—Å—ã–≤–∞—Ç—å –ø–æ—Å—Ç–æ—è–Ω–Ω—ã–µ –æ–±—ä–µ–∫—Ç—ã (`'permanent'` –∑–∞—â–∏—â–µ–Ω—ã)
- –ü—Ä–µ–¥–º–µ—Ç—ã **–Ω–µ –º–æ–≥—É—Ç** –ø–µ—Ä–µ–∑–∞–ø–∏—Å—ã–≤–∞—Ç—å –ø–æ—Å—Ç–æ—è–Ω–Ω—ã–µ –æ–±—ä–µ–∫—Ç—ã –∏–ª–∏ –≤—Ä–∞–≥–æ–≤

## –°–∏—Å—Ç–µ–º–∞ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç

### –ú–∏—Ä–æ–≤—ã–µ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã

- **–î–∏–∞–ø–∞–∑–æ–Ω:** 0-2048 –ø–æ –æ–±–µ–∏–º –æ—Å—è–º
- **–ï–¥–∏–Ω–∏—Ü–∞ –∏–∑–º–µ—Ä–µ–Ω–∏—è:** –≤–∏—Ä—Ç—É–∞–ª—å–Ω—ã–µ –ø–∏–∫—Å–µ–ª–∏
- **–¶–µ–Ω—Ç—Ä –∫–∞—Ä—Ç—ã:** (1024, 1024)

### –ö–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã —è—á–µ–µ–∫

- **–ò–Ω–¥–µ–∫—Å–∞—Ü–∏—è:** `(col, row)` ‚Äî –∫–æ–ª–æ–Ω–∫–∞ –∏ —Å—Ç—Ä–æ–∫–∞
- **–î–∏–∞–ø–∞–∑–æ–Ω:** 0-31 –ø–æ –æ–±–µ–∏–º –æ—Å—è–º
- **–õ–µ–≤—ã–π –≤–µ—Ä—Ö–Ω–∏–π —É–≥–æ–ª —è—á–µ–π–∫–∏ (col, row):** `(col * 64, row * 64)`
- **–¶–µ–Ω—Ç—Ä —è—á–µ–π–∫–∏ (col, row):** `(col * 64 + 32, row * 64 + 32)`

### –ö–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç

#### –ú–∏—Ä–æ–≤—ã–µ ‚Üí –Ø—á–µ–π–∫–∏

```typescript
worldToCell(x: number, y: number): CellPosition
```

- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç `Math.floor(x / 64)` –¥–ª—è –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è —è—á–µ–π–∫–∏
- –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç `{ col, row }` ‚Äî –∏–Ω–¥–µ–∫—Å—ã —è—á–µ–π–∫–∏

#### –Ø—á–µ–π–∫–∏ ‚Üí –ú–∏—Ä–æ–≤—ã–µ (—Ü–µ–Ω—Ç—Ä —è—á–µ–π–∫–∏)

```typescript
cellToWorld(col: number, row: number): WorldPosition
```

- –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Ü–µ–Ω—Ç—Ä —è—á–µ–π–∫–∏: `(col * 64 + 32, row * 64 + 32)`

#### –í—ã—Ä–∞–≤–Ω–∏–≤–∞–Ω–∏–µ –ø–æ —è—á–µ–π–∫–∞–º

```typescript
alignToCell(x: number, y: number): WorldPosition
```

- –ö–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ—Ç –º–∏—Ä–æ–≤—ã–µ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã –≤ —è—á–µ–π–∫—É –∏ –æ–±—Ä–∞—Ç–Ω–æ –≤ —Ü–µ–Ω—Ç—Ä —è—á–µ–π–∫–∏
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è –≤—ã—Ä–∞–≤–Ω–∏–≤–∞–Ω–∏—è –æ–±—ä–µ–∫—Ç–æ–≤ –ø–æ —Å–µ—Ç–∫–µ

## –†–∞–∑–º–µ—Ä—ã –æ–±—ä–µ–∫—Ç–æ–≤ –≤ —è—á–µ–π–∫–∞—Ö

| –û–±—ä–µ–∫—Ç | –†–∞–∑–º–µ—Ä (—è—á–µ–π–∫–∏) | –†–∞–∑–º–µ—Ä (–ø–∏–∫—Å–µ–ª–∏) | –ú–µ—Ç–æ–¥ —Å–ø–∞–≤–Ω–∞ |
|--------|----------------|------------------|--------------|
| –û—Ä–∞–∫—É–ª | 2√ó4 | 128√ó256 | `spawnOracleMatrix()` |
| –ü–µ—Ä—Å–æ–Ω–∞–∂ | 1√ó1 | 64√ó64 | `spawnPlayerMatrix()` |
| –ü–æ—Ä—Ç–∞–ª—ã (Random) | 4√ó3 | 256√ó192 | `spawnPortalMatrix()` |
| –ü–æ—Ä—Ç–∞–ª—ã (Tiled Map) | 2√ó3 | 128√ó192 | `occupyTiledPortal()` |
| –ö—É—Å—Ç—ã | 2√ó2 | 128√ó128 | `spawnBushMatrix()` |
| –ö–∞–º–Ω–∏ | 2√ó2 | 128√ó128 | `spawnStoneMatrix()` |
| –ú–æ–Ω–µ—Ç—ã | 1√ó1 | 64√ó64 | `spawnCoinMatrix()` |
| –ö–ª—é—á–∏ | 1√ó1 | 64√ó64 | `spawnKeyMatrix()` |
| –°–µ—Ä–¥–µ—á–∫–∏ | 1√ó1 | 64√ó64 | `spawnHeartMatrix()` |
| –í—Ä–∞–≥–∏ | 1√ó1 | 64√ó64 | `spawnEnemyMatrix()` |

## –ê–ª–≥–æ—Ä–∏—Ç–º –ø–æ–∑–∏—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è

### –û–±—â–∏–π –ø—Ä–∏–Ω—Ü–∏–ø

1.  **–û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –±–ª–æ–∫–∞ —è—á–µ–µ–∫:** –æ–±—ä–µ–∫—Ç –∑–∞–Ω–∏–º–∞–µ—Ç –ø—Ä—è–º–æ—É–≥–æ–ª—å–Ω—É—é –æ–±–ª–∞—Å—Ç—å —è—á–µ–µ–∫
2.  **–ü–æ–∏—Å–∫ —Å–≤–æ–±–æ–¥–Ω–æ–≥–æ –±–ª–æ–∫–∞:** —Å–∏—Å—Ç–µ–º–∞ –∏—â–µ—Ç —Å–≤–æ–±–æ–¥–Ω—É—é –æ–±–ª–∞—Å—Ç—å –Ω—É–∂–Ω–æ–≥–æ —Ä–∞–∑–º–µ—Ä–∞
3.  **–ó–∞–Ω—è—Ç–∏–µ —è—á–µ–µ–∫:** –±–ª–æ–∫ —è—á–µ–µ–∫ –ø–æ–º–µ—á–∞–µ—Ç—Å—è –∫–∞–∫ –∑–∞–Ω—è—Ç—ã–π
4.  **–†–∞—Å—á–µ—Ç —Ü–µ–Ω—Ç—Ä–∞ –±–ª–æ–∫–∞:** –≤—ã—á–∏—Å–ª—è–µ—Ç—Å—è —Ü–µ–Ω—Ç—Ä –±–ª–æ–∫–∞ –≤ –º–∏—Ä–æ–≤—ã—Ö –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–∞—Ö
5.  **–†–∞–∑–º–µ—â–µ–Ω–∏–µ –æ–±—ä–µ–∫—Ç–∞:** –æ–±—ä–µ–∫—Ç —Ä–∞–∑–º–µ—â–∞–µ—Ç—Å—è –≤ —Ü–µ–Ω—Ç—Ä–µ –±–ª–æ–∫–∞

### –ö–ª—é—á–µ–≤–æ–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ (2025-12-08)

**–ü—Ä–æ–±–ª–µ–º–∞:** –û–±—ä–µ–∫—Ç—ã —Ä–∞–∑–º–µ—â–∞–ª–∏—Å—å –≤ —Ü–µ–Ω—Ç—Ä–µ –æ–¥–Ω–æ–π —è—á–µ–π–∫–∏ –≤–Ω—É—Ç—Ä–∏ –±–ª–æ–∫–∞, –∞ –Ω–µ –≤ —Ü–µ–Ω—Ç—Ä–µ –≤—Å–µ–≥–æ –±–ª–æ–∫–∞.

**–†–µ—à–µ–Ω–∏–µ:** –¶–µ–Ω—Ç—Ä –±–ª–æ–∫–∞ –≤—ã—á–∏—Å–ª—è–µ—Ç—Å—è –Ω–∞–ø—Ä—è–º—É—é:

```typescript
// ‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω—ã–π —Ä–∞—Å—á–µ—Ç —Ü–µ–Ω—Ç—Ä–∞ –±–ª–æ–∫–∞
const blockLeft = cellPos.col * cellSize;      // –õ–µ–≤—ã–π –≤–µ—Ä—Ö–Ω–∏–π —É–≥–æ–ª –±–ª–æ–∫–∞
const blockTop = cellPos.row * cellSize;
const blockWidth = width * cellSize;          // –®–∏—Ä–∏–Ω–∞ –±–ª–æ–∫–∞ –≤ –ø–∏–∫—Å–µ–ª—è—Ö
const blockHeight = height * cellSize;       // –í—ã—Å–æ—Ç–∞ –±–ª–æ–∫–∞ –≤ –ø–∏–∫—Å–µ–ª—è—Ö
const blockCenterX = blockLeft + blockWidth / 2;  // –¶–µ–Ω—Ç—Ä –±–ª–æ–∫–∞ –ø–æ X
const blockCenterY = blockTop + blockHeight / 2;  // –¶–µ–Ω—Ç—Ä –±–ª–æ–∫–∞ –ø–æ Y
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** –û–±—ä–µ–∫—Ç—ã —Ç–µ–ø–µ—Ä—å —Ä–∞–∑–º–µ—â–∞—é—Ç—Å—è —Ç–æ—á–Ω–æ –≤ —Ü–µ–Ω—Ç—Ä–µ –±–ª–æ–∫–∞ —è—á–µ–µ–∫, –∫–æ—Ç–æ—Ä—ã–π –æ–Ω–∏ –∑–∞–Ω–∏–º–∞—é—Ç, —á—Ç–æ —Å–æ–≤–ø–∞–¥–∞–µ—Ç —Å –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏–µ–π –æ—Ç–ª–∞–¥–æ—á–Ω–æ–π —Å–µ—Ç–∫–∏.

## –ú–µ—Ç–æ–¥—ã SpawnMatrix

### –ë–∞–∑–æ–≤—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏

#### `worldToCell(x, y)`
–ö–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ—Ç –º–∏—Ä–æ–≤—ã–µ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã –≤ –∏–Ω–¥–µ–∫—Å—ã —è—á–µ–µ–∫.

#### `cellToWorld(col, row)`
–ö–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ—Ç –∏–Ω–¥–µ–∫—Å—ã —è—á–µ–µ–∫ –≤ –º–∏—Ä–æ–≤—ã–µ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã (—Ü–µ–Ω—Ç—Ä —è—á–µ–π–∫–∏).

#### `alignToCell(x, y)`
–í—ã—Ä–∞–≤–Ω–∏–≤–∞–µ—Ç –º–∏—Ä–æ–≤—ã–µ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã –ø–æ —Ü–µ–Ω—Ç—Ä—É –±–ª–∏–∂–∞–π—à–µ–π —è—á–µ–π–∫–∏.

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –∏ –∑–∞–Ω—è—Ç–∏–µ

#### `isRectFree(col, row, width, height, ignoreEnemies)`
–ü—Ä–æ–≤–µ—Ä—è–µ—Ç, —Å–≤–æ–±–æ–¥–µ–Ω –ª–∏ –ø—Ä—è–º–æ—É–≥–æ–ª—å–Ω–∏–∫ —è—á–µ–µ–∫.

#### `occupyRect(col, row, width, height, type)`
–ó–∞–Ω–∏–º–∞–µ—Ç –ø—Ä—è–º–æ—É–≥–æ–ª—å–Ω–∏–∫ —è—á–µ–µ–∫ —É–∫–∞–∑–∞–Ω–Ω—ã–º —Ç–∏–ø–æ–º.

#### `tryOccupyRect(col, row, width, height, type, ignoreEnemies)`
‚úÖ **–ê—Ç–æ–º–∞—Ä–Ω–∞—è –æ–ø–µ—Ä–∞—Ü–∏—è:** –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –∏ –∑–∞–Ω–∏–º–∞–µ—Ç –ø—Ä—è–º–æ—É–≥–æ–ª—å–Ω–∏–∫ —è—á–µ–µ–∫ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ.
- –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç `true`, –µ—Å–ª–∏ —è—á–µ–π–∫–∞ –±—ã–ª–∞ —Å–≤–æ–±–æ–¥–Ω–∞ –∏ —É—Å–ø–µ—à–Ω–æ –∑–∞–Ω—è—Ç–∞
- –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç `false`, –µ—Å–ª–∏ —è—á–µ–π–∫–∞ —É–∂–µ –∑–∞–Ω—è—Ç–∞
- –ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ—Ç race condition –ø—Ä–∏ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ–º —Å–ø–∞–≤–Ω–µ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö –æ–±—ä–µ–∫—Ç–æ–≤

#### `freeRect(col, row, width, height, type)`
–û—Å–≤–æ–±–æ–∂–¥–∞–µ—Ç –ø—Ä—è–º–æ—É–≥–æ–ª—å–Ω–∏–∫ —è—á–µ–µ–∫ (—Ç–æ–ª—å–∫–æ –¥–ª—è `'item'` –∏–ª–∏ `'enemy'`).

### –ü–æ–∏—Å–∫ –ø–æ–∑–∏—Ü–∏–π

#### `findFreeRect(width, height, ignoreEnemies, maxAttempts)`
–ù–∞—Ö–æ–¥–∏—Ç —Å–ª—É—á–∞–π–Ω—É—é —Å–≤–æ–±–æ–¥–Ω—É—é –ø–æ–∑–∏—Ü–∏—é –¥–ª—è –±–ª–æ–∫–∞ –∑–∞–¥–∞–Ω–Ω–æ–≥–æ —Ä–∞–∑–º–µ—Ä–∞.

#### `findFreeRectOnCircle(centerX, centerY, radius, width, height, angleOffset, maxAttempts)`
–ù–∞—Ö–æ–¥–∏—Ç —Å–≤–æ–±–æ–¥–Ω—É—é –ø–æ–∑–∏—Ü–∏—é –Ω–∞ –æ–∫—Ä—É–∂–Ω–æ—Å—Ç–∏ (–¥–ª—è –ø–æ—Ä—Ç–∞–ª–æ–≤).

- –ü—Ä–æ–±—É–µ—Ç —Ä–∞–∑–Ω—ã–µ —É–≥–ª—ã –Ω–∞ –æ–∫—Ä—É–∂–Ω–æ—Å—Ç–∏
- –î–ª—è –∫–∞–∂–¥–æ–≥–æ —É–≥–ª–∞ –≤—ã—á–∏—Å–ª—è–µ—Ç –ø–æ–∑–∏—Ü–∏—é –∏ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å –±–ª–æ–∫–∞
- –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –ª–µ–≤—ã–π –≤–µ—Ä—Ö–Ω–∏–π —É–≥–æ–ª –±–ª–æ–∫–∞ —è—á–µ–µ–∫

### –û—Ç–ª–∞–¥–æ—á–Ω—ã–µ –º–µ—Ç–æ–¥—ã

#### `getMatrix()`
–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –∫–æ–ø–∏—é –º–∞—Ç—Ä–∏—Ü—ã –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏.

#### `getMatrixSize()`
–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Ä–∞–∑–º–µ—Ä—ã –º–∞—Ç—Ä–∏—Ü—ã –∏ —Ä–∞–∑–º–µ—Ä —è—á–µ–π–∫–∏.

## –ú–µ—Ç–æ–¥—ã SpawnSystem

### –°–ø–∞–≤–Ω –ø–æ—Å—Ç–æ—è–Ω–Ω—ã—Ö –æ–±—ä–µ–∫—Ç–æ–≤

#### `spawnOracleMatrix()`
- –†–∞–∑–º–µ—Ä: 2√ó4 —è—á–µ–π–∫–∏ (128√ó256 –ø–∏–∫—Å–µ–ª–µ–π)
- –ü–æ–∑–∏—Ü–∏—è: —Ü–µ–Ω—Ç—Ä –∫–∞—Ä—Ç—ã (1024, 1024)
- –ê–ª–≥–æ—Ä–∏—Ç–º:
  1. –í—ã—Ä–∞–≤–Ω–∏–≤–∞–µ—Ç —Ü–µ–Ω—Ç—Ä –∫–∞—Ä—Ç—ã –ø–æ —è—á–µ–π–∫–µ
  2. –°–º–µ—â–∞–µ—Ç –±–ª–æ–∫ –Ω–∞ 1 —è—á–µ–π–∫—É –≤–ª–µ–≤–æ –∏ 2 —è—á–µ–π–∫–∏ –≤–≤–µ—Ä—Ö
  3. –ó–∞–Ω–∏–º–∞–µ—Ç –±–ª–æ–∫ 2√ó4 —è—á–µ–π–∫–∏
  4. –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Ü–µ–Ω—Ç—Ä –±–ª–æ–∫–∞

#### `spawnPlayerMatrix(oracleX, oracleY)`
- –†–∞–∑–º–µ—Ä: 1√ó1 —è—á–µ–π–∫–∞ (64√ó64 –ø–∏–∫—Å–µ–ª–µ–π)
- –ü–æ–∑–∏—Ü–∏—è: –ø–æ–¥ –æ—Ä–∞–∫—É–ª–æ–º (—Å–º–µ—â–µ–Ω–∏–µ +128 –ø–∏–∫—Å–µ–ª–µ–π –ø–æ Y)
- –ê–ª–≥–æ—Ä–∏—Ç–º:
  1. –í—ã—á–∏—Å–ª—è–µ—Ç –ø–æ–∑–∏—Ü–∏—é –ø–æ–¥ –æ—Ä–∞–∫—É–ª–æ–º
  2. –í—ã—Ä–∞–≤–Ω–∏–≤–∞–µ—Ç –ø–æ —è—á–µ–π–∫–µ
  3. –ó–∞–Ω–∏–º–∞–µ—Ç 1√ó1 —è—á–µ–π–∫—É
  4. –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Ü–µ–Ω—Ç—Ä —è—á–µ–π–∫–∏

#### `spawnPortalMatrix(centerX, centerY, radius, angleOffset)`
- –†–∞–∑–º–µ—Ä: 4√ó3 —è—á–µ–π–∫–∏ (256√ó192 –ø–∏–∫—Å–µ–ª–µ–π)
- –ü–æ–∑–∏—Ü–∏—è: –Ω–∞ –æ–∫—Ä—É–∂–Ω–æ—Å—Ç–∏ –≤–æ–∫—Ä—É–≥ —Ü–µ–Ω—Ç—Ä–∞
- –ê–ª–≥–æ—Ä–∏—Ç–º:
  1. –ò—â–µ—Ç —Å–≤–æ–±–æ–¥–Ω—ã–π –±–ª–æ–∫ –Ω–∞ –æ–∫—Ä—É–∂–Ω–æ—Å—Ç–∏ —á–µ—Ä–µ–∑ `findFreeRectOnCircle`
  2. –í—ã—á–∏—Å–ª—è–µ—Ç —Ü–µ–Ω—Ç—Ä –±–ª–æ–∫–∞ 4√ó3 —è—á–µ–µ–∫
  3. –ó–∞–Ω–∏–º–∞–µ—Ç –±–ª–æ–∫ —è—á–µ–µ–∫
  4. –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Ü–µ–Ω—Ç—Ä –±–ª–æ–∫–∞

#### `spawnBushMatrix()`
- **–†–µ–∂–∏–º:** –¢–æ–ª—å–∫–æ Standard Mode (`useTiledMap: false`)
- –†–∞–∑–º–µ—Ä: 2√ó2 —è—á–µ–π–∫–∏ (128√ó128 –ø–∏–∫—Å–µ–ª–µ–π)
- –ü–æ–∑–∏—Ü–∏—è: —Å–ª—É—á–∞–π–Ω–∞—è —Å–≤–æ–±–æ–¥–Ω–∞—è –ø–æ–∑–∏—Ü–∏—è (—É—á–∏—Ç—ã–≤–∞–µ—Ç –∑–∞–ø—Ä–µ—Ç–Ω—ã–µ –∑–æ–Ω—ã)
- Z-–ø–æ—Ä—è–¥–æ–∫: `depth: 1` (—Å—Ä–∞–∑—É –ø–æ—Å–ª–µ TILED_MAP: 0)
- –ê–ª–≥–æ—Ä–∏—Ç–º:
  1. –ò—â–µ—Ç —Å–≤–æ–±–æ–¥–Ω—ã–π –±–ª–æ–∫ 2√ó2 —á–µ—Ä–µ–∑ `findFreeRect`
  2. –í—ã—á–∏—Å–ª—è–µ—Ç —Ü–µ–Ω—Ç—Ä –±–ª–æ–∫–∞ 2√ó2 —è—á–µ–µ–∫ –Ω–∞–ø—Ä—è–º—É—é:
     ```typescript
     const blockLeft = cellPos.col * cellSize;
     const blockTop = cellPos.row * cellSize;
     const blockCenterX = blockLeft + blockWidth / 2;  // 128 * 2 / 2 = 128
     const blockCenterY = blockTop + blockHeight / 2; // 128 * 2 / 2 = 128
     ```
  3. –ó–∞–Ω–∏–º–∞–µ—Ç –±–ª–æ–∫ —è—á–µ–µ–∫ –∫–∞–∫ `'permanent'`
  4. –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Ü–µ–Ω—Ç—Ä –±–ª–æ–∫–∞

#### `spawnStoneMatrix()`
- **–†–µ–∂–∏–º:** –¢–æ–ª—å–∫–æ Standard Mode (`useTiledMap: false`)
- –†–∞–∑–º–µ—Ä: 2√ó2 —è—á–µ–π–∫–∏ (128√ó128 –ø–∏–∫—Å–µ–ª–µ–π)
- –ü–æ–∑–∏—Ü–∏—è: —Å–ª—É—á–∞–π–Ω–∞—è —Å–≤–æ–±–æ–¥–Ω–∞—è –ø–æ–∑–∏—Ü–∏—è (—É—á–∏—Ç—ã–≤–∞–µ—Ç –∑–∞–ø—Ä–µ—Ç–Ω—ã–µ –∑–æ–Ω—ã)
- Z-–ø–æ—Ä—è–¥–æ–∫: `depth: 1` (—Å—Ä–∞–∑—É –ø–æ—Å–ª–µ TILED_MAP: 0)
- –ê–ª–≥–æ—Ä–∏—Ç–º:
  1. –ò—â–µ—Ç —Å–≤–æ–±–æ–¥–Ω—ã–π –±–ª–æ–∫ 2√ó2 —á–µ—Ä–µ–∑ `findFreeRect`
  2. –í—ã—á–∏—Å–ª—è–µ—Ç —Ü–µ–Ω—Ç—Ä –±–ª–æ–∫–∞ 2√ó2 —è—á–µ–µ–∫ –Ω–∞–ø—Ä—è–º—É—é (–∞–Ω–∞–ª–æ–≥–∏—á–Ω–æ –∫—É—Å—Ç–∞–º)
  3. –ó–∞–Ω–∏–º–∞–µ—Ç –±–ª–æ–∫ —è—á–µ–µ–∫ –∫–∞–∫ `'permanent'`
  4. –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Ü–µ–Ω—Ç—Ä –±–ª–æ–∫–∞

### –°–ø–∞–≤–Ω –ø—Ä–µ–¥–º–µ—Ç–æ–≤

#### `spawnHeartMatrix()`
- –†–∞–∑–º–µ—Ä: 1√ó1 —è—á–µ–π–∫–∞ (64√ó64 –ø–∏–∫—Å–µ–ª–µ–π)
- –¢–∏–ø: `'item'`
- –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Ü–µ–Ω—Ç—Ä —è—á–µ–π–∫–∏

#### `spawnCoinMatrix()`
- –†–∞–∑–º–µ—Ä: 1√ó1 —è—á–µ–π–∫–∞ (64√ó64 –ø–∏–∫—Å–µ–ª–µ–π)
- –¢–∏–ø: `'item'`
- –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Ü–µ–Ω—Ç—Ä —è—á–µ–π–∫–∏
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –≤ `COIN` —Ñ–∞–∑–µ.

#### `spawnKeyMatrix()`
- –†–∞–∑–º–µ—Ä: 1√ó1 —è—á–µ–π–∫–∞ (64√ó64 –ø–∏–∫—Å–µ–ª–µ–π)
- –¢–∏–ø: `'item'`
- –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Ü–µ–Ω—Ç—Ä —è—á–µ–π–∫–∏
- ‚úÖ **–ê—Ç–æ–º–∞—Ä–Ω–∞—è –æ–ø–µ—Ä–∞—Ü–∏—è:** –∏—Å–ø–æ–ª—å–∑—É–µ—Ç `tryOccupyRect()` –¥–ª—è –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏—è race condition
- ‚úÖ **–ó–∞—â–∏—Ç–∞ –æ—Ç –¥—É–±–ª–∏–∫–∞—Ç–æ–≤:** –¥–æ 5 –ø–æ–ø—ã—Ç–æ–∫ –Ω–∞–π—Ç–∏ —Å–≤–æ–±–æ–¥–Ω—É—é —è—á–µ–π–∫—É
- ‚úÖ **–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞:** –≤ `spawnItems()` –ø—Ä–æ–≤–µ—Ä—è—é—Ç—Å—è –¥—É–±–ª–∏–∫–∞—Ç—ã –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç —É–∂–µ —Å–æ–∑–¥–∞–Ω–Ω—ã—Ö –∫–ª—é—á–µ–π

### –°–ø–∞–≤–Ω –≤—Ä–∞–≥–æ–≤

#### –°–ø–∞–≤–Ω –ø–æ —Ñ–∞–∑–∞–º
–°–∏—Å—Ç–µ–º–∞ —Å–ø–∞–≤–Ω–∞ —É—á–∏—Ç—ã–≤–∞–µ—Ç —Ç–µ–∫—É—â—É—é —Ñ–∞–∑—É –∏–≥—Ä—ã (`GamePhase`):
- **–§–∞–∑–∞ COIN:** –ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä –ø—Ä–µ–¥–º–µ—Ç–æ–≤ —Å–æ–∑–¥–∞–µ—Ç —Ç–æ–ª—å–∫–æ –º–æ–Ω–µ—Ç—ã –∏ —Å–µ—Ä–¥–µ—á–∫–∏.
- **–§–∞–∑–∞ KEY:** –ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä –ø—Ä–µ–¥–º–µ—Ç–æ–≤ —Å–æ–∑–¥–∞–µ—Ç —Ç–æ–ª—å–∫–æ –∫–ª—é—á–∏ –∏ —Å–µ—Ä–¥–µ—á–∫–∏.
- –ü—Ä–∏ —Å–º–µ–Ω–µ —Ñ–∞–∑—ã –≤—Å–µ –Ω–µ—Å–æ–±—Ä–∞–Ω–Ω—ã–µ –º–æ–Ω–µ—Ç—ã —É–¥–∞–ª—è—é—Ç—Å—è –∏–∑ –≥—Ä—É–ø–ø—ã `coinsGroup` –∏ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–µ —è—á–µ–π–∫–∏ –º–∞—Ç—Ä–∏—Ü—ã –æ—Å–≤–æ–±–æ–∂–¥–∞—é—Ç—Å—è.

#### `spawnEnemyMatrix()`
- –†–∞–∑–º–µ—Ä: 1√ó1 —è—á–µ–π–∫–∞ (64√ó64 –ø–∏–∫—Å–µ–ª–µ–π)
- –¢–∏–ø: `'enemy'`
- –ú–æ–∂–µ—Ç –ø–µ—Ä–µ–∑–∞–ø–∏—Å—ã–≤–∞—Ç—å –ø—Ä–µ–¥–º–µ—Ç—ã (`'item'` ‚Üí `'enemy'`)
- –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Ü–µ–Ω—Ç—Ä —è—á–µ–π–∫–∏

### –û—Å–≤–æ–±–æ–∂–¥–µ–Ω–∏–µ –ø–æ–∑–∏—Ü–∏–π

#### `freePositionMatrix(x, y, width, height, type)`
–û—Å–≤–æ–±–æ–∂–¥–∞–µ—Ç –ø–æ–∑–∏—Ü–∏—é –ø—Ä–µ–¥–º–µ—Ç–∞ –∏–ª–∏ –≤—Ä–∞–≥–∞ –ø—Ä–∏ –ø–æ–¥–Ω—è—Ç–∏–∏/—É–Ω–∏—á—Ç–æ–∂–µ–Ω–∏–∏.

- –ö–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ—Ç –º–∏—Ä–æ–≤—ã–µ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã –≤ —è—á–µ–π–∫–∏
- –í—ã—á–∏—Å–ª—è–µ—Ç –ª–µ–≤—ã–π –≤–µ—Ä—Ö–Ω–∏–π —É–≥–æ–ª –±–ª–æ–∫–∞
- –û—Å–≤–æ–±–æ–∂–¥–∞–µ—Ç –±–ª–æ–∫ —á–µ—Ä–µ–∑ `freeRect`

## –ó–∞–ø—Ä–µ—Ç–Ω—ã–µ –∑–æ–Ω—ã (Forbidden Zones)

**–î–æ–±–∞–≤–ª–µ–Ω–æ:** 2026-02-03

### –û–±–∑–æ—Ä

–°–∏—Å—Ç–µ–º–∞ –∑–∞–ø—Ä–µ—Ç–Ω—ã—Ö –∑–æ–Ω –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ—Ç —Å–ø–∞–≤–Ω –∫—É—Å—Ç–æ–≤ –∏ –∫–∞–º–Ω–µ–π —Ä—è–¥–æ–º —Å –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–º–∏ –æ–±—ä–µ–∫—Ç–∞–º–∏ (–û—Ä–∞–∫—É–ª –∏ –ø–æ—Ä—Ç–∞–ª—ã). –≠—Ç–æ –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç:

1. **–°–≤–æ–±–æ–¥–Ω—ã–π –ø—Ä–æ—Ö–æ–¥** –∫ –û—Ä–∞–∫—É–ª—É –∏ –ø–æ—Ä—Ç–∞–ª–∞–º
2. **–í–∏–∑—É–∞–ª—å–Ω—É—é —á–∏—Å—Ç–æ—Ç—É** - –∫—É—Å—Ç—ã/–∫–∞–º–Ω–∏ –Ω–µ –∑–∞–≥–æ—Ä–∞–∂–∏–≤–∞—é—Ç –≤–∞–∂–Ω—ã–µ –æ–±—ä–µ–∫—Ç—ã
3. **–ü—Ä–∞–≤–∏–ª—å–Ω—É—é –∏–≥—Ä—É** - –∏–≥—Ä–æ–∫ –º–æ–∂–µ—Ç –ª–µ–≥–∫–æ –ø–æ–¥–æ–π—Ç–∏ –∫ –û—Ä–∞–∫—É–ª—É –∏ –ø–æ—Ä—Ç–∞–ª–∞–º

### –ú–µ—Ç–æ–¥—ã –∑–∞–ø—Ä–µ—Ç–Ω—ã—Ö –∑–æ–Ω

#### `addForbiddenZone(col, row, width, height, margin)`
–î–æ–±–∞–≤–ª—è–µ—Ç –∑–∞–ø—Ä–µ—Ç–Ω—É—é –∑–æ–Ω—É –≤–æ–∫—Ä—É–≥ —É–∫–∞–∑–∞–Ω–Ω–æ–≥–æ –±–ª–æ–∫–∞ —Å –æ—Ç—Å—Ç—É–ø–æ–º.

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:**
- `col, row` ‚Äî –ª–µ–≤—ã–π –≤–µ—Ä—Ö–Ω–∏–π —É–≥–æ–ª –±–ª–æ–∫–∞
- `width, height` ‚Äî —Ä–∞–∑–º–µ—Ä –±–ª–æ–∫–∞ –≤ —è—á–µ–π–∫–∞—Ö
- `margin` ‚Äî –æ—Ç—Å—Ç—É–ø –≤ —è—á–µ–π–∫–∞—Ö (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 2)

**–ü—Ä–∏–º–µ—Ä:**
```typescript
// –û—Ä–∞–∫—É–ª 2√ó4 —è—á–µ–π–∫–∏ ‚Üí –∑–∞–ø—Ä–µ—Ç–Ω–∞—è –∑–æ–Ω–∞ 6√ó8 —è—á–µ–µ–∫
spawnMatrix.addForbiddenZone(oracleCol, oracleRow, 2, 4, 2);

// –ü–æ—Ä—Ç–∞–ª 4√ó3 —è—á–µ–π–∫–∏ ‚Üí –∑–∞–ø—Ä–µ—Ç–Ω–∞—è –∑–æ–Ω–∞ 8√ó7 —è—á–µ–µ–∫
spawnMatrix.addForbiddenZone(portalCol, portalRow, 4, 3, 2);
```

#### `isInForbiddenZone(col, row, width, height)`
–ü—Ä–æ–≤–µ—Ä—è–µ—Ç, –ø–µ—Ä–µ—Å–µ–∫–∞–µ—Ç—Å—è –ª–∏ —É–∫–∞–∑–∞–Ω–Ω—ã–π –±–ª–æ–∫ —Å –ª—é–±–æ–π –∑–∞–ø—Ä–µ—Ç–Ω–æ–π –∑–æ–Ω–æ–π.

–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç `true`, –µ—Å–ª–∏ –µ—Å—Ç—å –ø–µ—Ä–µ—Å–µ—á–µ–Ω–∏–µ —Å –∑–∞–ø—Ä–µ—Ç–Ω–æ–π –∑–æ–Ω–æ–π.

#### `clearForbiddenZones()`
–û—á–∏—â–∞–µ—Ç –≤—Å–µ –∑–∞–ø—Ä–µ—Ç–Ω—ã–µ –∑–æ–Ω—ã.

**–ö–æ–≥–¥–∞ –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è:**
- –ü—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –Ω–æ–≤–æ–≥–æ –º–∏—Ä–∞ –≤ `WorldFactory.create()`
- –ü–µ—Ä–µ–¥ –≥–µ–Ω–µ—Ä–∞—Ü–∏–µ–π —Å–ª—É—á–∞–π–Ω—ã—Ö –∫—É—Å—Ç–æ–≤ –∏ –∫–∞–º–Ω–µ–π

### –†–∞–∑–º–µ—Ä—ã –∑–∞–ø—Ä–µ—Ç–Ω—ã—Ö –∑–æ–Ω

| –û–±—ä–µ–∫—Ç | –†–∞–∑–º–µ—Ä –æ–±—ä–µ–∫—Ç–∞ | –û—Ç—Å—Ç—É–ø | –†–∞–∑–º–µ—Ä –∑–∞–ø—Ä–µ—Ç–Ω–æ–π –∑–æ–Ω—ã |
|--------|---------------|--------|----------------------|
| –û—Ä–∞–∫—É–ª | 2√ó4 | 2 —è—á–µ–π–∫–∏ | 6√ó8 —è—á–µ–µ–∫ |
| –ü–æ—Ä—Ç–∞–ª | 4√ó3 | 2 —è—á–µ–π–∫–∏ | 8√ó7 —è—á–µ–µ–∫ |

### –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –ø—Ä–æ–≤–µ—Ä–∫–æ–π —Å–≤–æ–±–æ–¥–Ω—ã—Ö —è—á–µ–µ–∫

–ú–µ—Ç–æ–¥ `isRectFree()` —Ç–µ–ø–µ—Ä—å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –∑–∞–ø—Ä–µ—Ç–Ω—ã–µ –∑–æ–Ω—ã:

```typescript
// –í SpawnMatrix.isRectFree()
if (this.isInForbiddenZone(col, row, width, height)) {
    return false; // –ë–ª–æ–∫ –ø–µ—Ä–µ—Å–µ–∫–∞–µ—Ç –∑–∞–ø—Ä–µ—Ç–Ω—É—é –∑–æ–Ω—É
}
```

### –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –∑–∞–ø—Ä–µ—Ç–Ω—ã—Ö –∑–æ–Ω

–ó–∞–ø—Ä–µ—Ç–Ω—ã–µ –∑–æ–Ω—ã —Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É—é—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–∏ —Å–ø–∞–≤–Ω–µ –ø–æ—Å—Ç–æ—è–Ω–Ω—ã—Ö –æ–±—ä–µ–∫—Ç–æ–≤:

**–í `SpawnSystem.spawnOracleMatrix()`:**
```typescript
this.spawnMatrix.occupyRect(offsetCol, offsetRow, 2, 4, 'permanent');
this.spawnMatrix.addForbiddenZone(offsetCol, offsetRow, 2, 4, 2);
```

**–í `SpawnSystem.spawnPortalMatrix()`:**
```typescript
this.spawnMatrix.occupyRect(cellPos.col, cellPos.row, 4, 3, 'permanent');
this.spawnMatrix.addForbiddenZone(cellPos.col, cellPos.row, 4, 3, 2);
```

**–í `SpawnSystem.occupyTiledPortal()`:**
```typescript
this.spawnMatrix.occupyRect(offsetCol, offsetRow, widthInCells, heightInCells, 'permanent');
this.spawnMatrix.addForbiddenZone(offsetCol, offsetRow, widthInCells, heightInCells, 2);
```

## –û—Ç–ª–∞–¥–æ—á–Ω–∞—è –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è

### –í–∫–ª—é—á–µ–Ω–∏–µ –æ—Ç–ª–∞–¥–∫–∏

–£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –≤ `.env`:
```env
VITE_DEBUG_UI_ENABLED=true
```

### –í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è —Å–µ—Ç–∫–∏

–ü—Ä–∏ –≤–∫–ª—é—á–µ–Ω–Ω–æ–π –æ—Ç–ª–∞–¥–∫–µ:
- **–°–µ—Ç–∫–∞ —è—á–µ–µ–∫:** –±–µ–ª—ã–µ –ª–∏–Ω–∏–∏ (–ø—Ä–æ–∑—Ä–∞—á–Ω–æ—Å—Ç—å 0.5)
- **–ó–∞–Ω—è—Ç—ã–µ —è—á–µ–π–∫–∏:**
  - üî¥ –ö—Ä–∞—Å–Ω—ã–µ ‚Äî –ø–æ—Å—Ç–æ—è–Ω–Ω—ã–µ –æ–±—ä–µ–∫—Ç—ã (`'permanent'`) ‚Äî –ø—Ä–æ–∑—Ä–∞—á–Ω–æ—Å—Ç—å 0.5
  - üü° –ñ–µ–ª—Ç—ã–µ ‚Äî –ø—Ä–µ–¥–º–µ—Ç—ã (`'item'`) ‚Äî –ø—Ä–æ–∑—Ä–∞—á–Ω–æ—Å—Ç—å 0.3
  - üîµ –°–∏–Ω–∏–µ ‚Äî –≤—Ä–∞–≥–∏ (`'enemy'`) ‚Äî –ø—Ä–æ–∑—Ä–∞—á–Ω–æ—Å—Ç—å 0.3
- **–ì—Ä–∞–Ω–∏—Ü—ã –∫–∞—Ä—Ç—ã:** –≥–æ–ª—É–±—ã–µ –ª–∏–Ω–∏–∏ (–ø—Ä–æ–∑—Ä–∞—á–Ω–æ—Å—Ç—å 0.8)

### –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏—è

–ö—Ä–∞—Å–Ω—ã–µ –ø—Ä—è–º–æ—É–≥–æ–ª—å–Ω–∏–∫–∏ –≤ –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏–∏ –¥–æ–ª–∂–Ω—ã **—Ç–æ—á–Ω–æ —Å–æ–≤–ø–∞–¥–∞—Ç—å** —Å —Ä–µ–∞–ª—å–Ω—ã–º–∏ –ø–æ–∑–∏—Ü–∏—è–º–∏ –æ–±—ä–µ–∫—Ç–æ–≤:
- –ü–æ—Ä—Ç–∞–ª—ã ‚Äî –∫—Ä–∞—Å–Ω—ã–π –±–ª–æ–∫ 4√ó3 —è—á–µ–π–∫–∏
- –û—Ä–∞–∫—É–ª ‚Äî –∫—Ä–∞—Å–Ω—ã–π –±–ª–æ–∫ 2√ó4 —è—á–µ–π–∫–∏
- –ö—É—Å—Ç—ã ‚Äî –∫—Ä–∞—Å–Ω—ã–π –±–ª–æ–∫ 2√ó2 —è—á–µ–π–∫–∏

–ï—Å–ª–∏ –µ—Å—Ç—å —Å–º–µ—â–µ–Ω–∏–µ, —ç—Ç–æ —É–∫–∞–∑—ã–≤–∞–µ—Ç –Ω–∞ –ø—Ä–æ–±–ª–µ–º—É –≤ —Ä–∞—Å—á–µ—Ç–µ —Ü–µ–Ω—Ç—Ä–∞ –±–ª–æ–∫–∞.

## –ü–æ—Ä—è–¥–æ–∫ —Å–ø–∞–≤–Ω–∞

1. **–û—Ä–∞–∫—É–ª** ‚Äî —Ü–µ–Ω—Ç—Ä –∫–∞—Ä—Ç—ã (2√ó4 —è—á–µ–π–∫–∏)
2. **–ü–µ—Ä—Å–æ–Ω–∞–∂** ‚Äî –ø–æ–¥ –æ—Ä–∞–∫—É–ª–æ–º (1√ó1 —è—á–µ–π–∫–∞)
3. **–ü–æ—Ä—Ç–∞–ª—ã** ‚Äî –Ω–∞ –æ–∫—Ä—É–∂–Ω–æ—Å—Ç–∏ –≤–æ–∫—Ä—É–≥ —Ü–µ–Ω—Ç—Ä–∞ (4√ó3 —è—á–µ–π–∫–∏ –∫–∞–∂–¥—ã–π)
4. **–ö—É—Å—Ç—ã** ‚Äî —Å–ª—É—á–∞–π–Ω—ã–µ –ø–æ–∑–∏—Ü–∏–∏ (2√ó2 —è—á–µ–π–∫–∏ –∫–∞–∂–¥—ã–π)
5. **–ö–∞–º–Ω–∏** ‚Äî —Å–ª—É—á–∞–π–Ω—ã–µ –ø–æ–∑–∏—Ü–∏–∏ (2√ó2 —è—á–µ–π–∫–∏ –∫–∞–∂–¥—ã–π)
6. **–ü—Ä–µ–¥–º–µ—Ç—ã** ‚Äî —Å–ª—É—á–∞–π–Ω—ã–µ –ø–æ–∑–∏—Ü–∏–∏ (1√ó1 —è—á–µ–π–∫–∞ –∫–∞–∂–¥—ã–π)
7. **–í—Ä–∞–≥–∏** ‚Äî —Å–ª—É—á–∞–π–Ω—ã–µ –ø–æ–∑–∏—Ü–∏–∏ (1√ó1 —è—á–µ–π–∫–∞ –∫–∞–∂–¥—ã–π, –º–æ–≥—É—Ç –ø–µ—Ä–µ–∑–∞–ø–∏—Å—ã–≤–∞—Ç—å –ø—Ä–µ–¥–º–µ—Ç—ã)

## –û—á–∏—Å—Ç–∫–∞ –º–∞—Ç—Ä–∏—Ü—ã

–ü—Ä–∏ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–µ —É—Ä–æ–≤–Ω—è –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è:
–ü—Ä–∏ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–µ —É—Ä–æ–≤–Ω—è –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è:
```typescript
spawnSystem.clearOccupiedZones()
spawnSystem.clearForbiddenZones() // ‚ö†Ô∏è –û—á–∏—Å—Ç–∫–∞ –∑–∞–ø—Ä–µ—Ç–Ω—ã—Ö –∑–æ–Ω
```

–≠—Ç–æ –æ—á–∏—â–∞–µ—Ç –≤—Å—é –º–∞—Ç—Ä–∏—Ü—É, —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—è –≤—Å–µ —è—á–µ–π–∫–∏ –≤ `'free'`, –∏ —É–¥–∞–ª—è–µ—Ç –≤—Å–µ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∑–∞–ø—Ä–µ—Ç–Ω—ã–µ –∑–æ–Ω—ã.

## –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

### –°–ø–∞–≤–Ω –ø–æ—Ä—Ç–∞–ª–∞

```typescript
const posResult = spawnSystem.spawnPortalMatrix(
  MAP_CENTER_X,  // –¶–µ–Ω—Ç—Ä –æ–∫—Ä—É–∂–Ω–æ—Å—Ç–∏
  MAP_CENTER_Y,
  768,           // –†–∞–¥–∏—É—Å –æ–∫—Ä—É–∂–Ω–æ—Å—Ç–∏
  angle          // –£–≥–æ–ª —Ä–∞–∑–º–µ—â–µ–Ω–∏—è
);

if (posResult.success) {
  const portal = new StandardPortal(
    scene,
    config,
    posResult.x,  // –¶–µ–Ω—Ç—Ä –±–ª–æ–∫–∞ 4√ó3 —è—á–µ–µ–∫
    posResult.y
  );
}
```

### –û—Å–≤–æ–±–æ–∂–¥–µ–Ω–∏–µ –ø–æ–∑–∏—Ü–∏–∏ –ø—Ä–µ–¥–º–µ—Ç–∞

```typescript
// –ü—Ä–∏ –ø–æ–¥–Ω—è—Ç–∏–∏ –∫–ª—é—á–∞ –∏–ª–∏ —Å–µ—Ä–¥–µ—á–∫–∞
spawnSystem.freePositionMatrix(
  itemX,    // –ú–∏—Ä–æ–≤—ã–µ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã –ø—Ä–µ–¥–º–µ—Ç–∞
  itemY,
  1,        // –®–∏—Ä–∏–Ω–∞ –≤ —è—á–µ–π–∫–∞—Ö
  1,        // –í—ã—Å–æ—Ç–∞ –≤ —è—á–µ–π–∫–∞—Ö
  'item'    // –¢–∏–ø –∑–∞–Ω—è—Ç–æ—Å—Ç–∏
);
```

## –ò–∑–≤–µ—Å—Ç–Ω—ã–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è

1. **–†–∞–∑–º–µ—Ä —è—á–µ–π–∫–∏ —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω:** 64√ó64 –ø–∏–∫—Å–µ–ª–µ–π
2. **–û–±—ä–µ–∫—Ç—ã –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –∫—Ä–∞—Ç–Ω—ã —Ä–∞–∑–º–µ—Ä—É —è—á–µ–π–∫–∏:** –æ–±—ä–µ–∫—Ç—ã –±–æ–ª—å—à–µ 64√ó64 –∑–∞–Ω–∏–º–∞—é—Ç –Ω–µ—Å–∫–æ–ª—å–∫–æ —è—á–µ–µ–∫
3. **–í—Ä–∞–≥–∏ –º–æ–≥—É—Ç –ø–µ—Ä–µ–∑–∞–ø–∏—Å—ã–≤–∞—Ç—å –ø—Ä–µ–¥–º–µ—Ç—ã:** —ç—Ç–æ —Å–¥–µ–ª–∞–Ω–æ –Ω–∞–º–µ—Ä–µ–Ω–Ω–æ –¥–ª—è –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–æ–≥–æ —Å–ø–∞–≤–Ω–∞ –≤—Ä–∞–≥–æ–≤
4. **–ü–æ—Å—Ç–æ—è–Ω–Ω—ã–µ –æ–±—ä–µ–∫—Ç—ã –∑–∞—â–∏—â–µ–Ω—ã:** –∏—Ö –Ω–µ–ª—å–∑—è –ø–µ—Ä–µ–∑–∞–ø–∏—Å–∞—Ç—å

## –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Tiled Map

### –ö–æ–ª–ª–∏–∑–∏–∏ –∏–∑ Tiled Map

–ö–æ–ª–ª–∏–∑–∏–∏ –∏–∑ —Å–ª–æ—è "Collision Mask" Tiled Map –∏–Ω—Ç–µ–≥—Ä–∏—Ä—É—é—Ç—Å—è –≤ SpawnMatrix –∫–∞–∫ `'permanent'` —è—á–µ–π–∫–∏:

```typescript
// –ö–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç Tiled Map ‚Üí SpawnMatrix
// Tiled Map: —Ç–∞–π–ª—ã 8√ó8 –ø–∏–∫—Å–µ–ª–µ–π, –∫–∞—Ä—Ç–∞ 64√ó64 —Ç–∞–π–ª–æ–≤
// SpawnMatrix: —è—á–µ–π–∫–∏ 64√ó64 –ø–∏–∫—Å–µ–ª–µ–π, –º–∞—Ç—Ä–∏—Ü–∞ 32√ó32 —è—á–µ–π–∫–∏

const worldX = (col * tileWidth + tileWidth / 2) * BASE_SCALE;
const worldY = (row * tileHeight + tileHeight / 2) * BASE_SCALE;
this.spawnSystem.occupyPositionMatrix(worldX, worldY, 1, 1, 'permanent');
```

### –ü–æ—Ä—Ç–∞–ª—ã –∏–∑ Tiled Map

–ü–æ—Ä—Ç–∞–ª—ã –∏–∑ Tiled Map –∏—Å–ø–æ–ª—å–∑—É—é—Ç –Ω–æ–≤—ã–π –º–µ—Ç–æ–¥ `occupyTiledPortal()` –¥–ª—è —Ç–æ—á–Ω–æ–≥–æ —Ä–∞–∑–º–µ—â–µ–Ω–∏—è:

```typescript
// –í—ã—á–∏—Å–ª—è–µ–º —Ü–µ–Ω—Ç—Ä –æ–±—ä–µ–∫—Ç–∞ –∏–∑ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç Tiled Map
const centerX = obj.x + obj.width / 2;
const centerY = obj.y + obj.height / 2;
const worldX = centerX * BASE_SCALE;
const worldY = centerY * BASE_SCALE;

// –ó–∞–Ω–∏–º–∞–µ–º –∑–æ–Ω—É 2√ó3 —è—á–µ–π–∫–∏
this.spawnSystem.occupyTiledPortal(worldX, worldY, 2, 3);
```

**–ú–µ—Ç–æ–¥ `occupyTiledPortal()`:**
- –í—ã—á–∏—Å–ª—è–µ—Ç —Ü–µ–Ω—Ç—Ä –ø–æ—Ä—Ç–∞–ª–∞ –∏–∑ –º–∏—Ä–æ–≤—ã—Ö –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç
- –û–ø—Ä–µ–¥–µ–ª—è–µ—Ç —Å–º–µ—â–µ–Ω–∏–µ –¥–ª—è —Ä–∞–∑–º–µ—â–µ–Ω–∏—è –±–ª–æ–∫–∞ 2√ó3 —è—á–µ–µ–∫
- –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –≥—Ä–∞–Ω–∏—Ü—ã –º–∞—Ç—Ä–∏—Ü—ã –ø–µ—Ä–µ–¥ –∑–∞–Ω—è—Ç–∏–µ–º
- –ó–∞–Ω–∏–º–∞–µ—Ç —è—á–µ–π–∫–∏ –∫–∞–∫ `'permanent'`

**–û—Ç–ª–∏—á–∏—è –æ—Ç `spawnPortalMatrix()`:**
- `spawnPortalMatrix()` ‚Äî –¥–ª—è —Å–ª—É—á–∞–π–Ω–æ–≥–æ —Ä–∞–∑–º–µ—â–µ–Ω–∏—è (–∏—â–µ—Ç —Å–≤–æ–±–æ–¥–Ω–æ–µ –º–µ—Å—Ç–æ)
- `occupyTiledPortal()` ‚Äî –¥–ª—è —Ç–æ—á–Ω–æ–≥–æ —Ä–∞–∑–º–µ—â–µ–Ω–∏—è –∏–∑ Tiled Map (–∑–∞–Ω–∏–º–∞–µ—Ç —É–∫–∞–∑–∞–Ω–Ω—É—é –ø–æ–∑–∏—Ü–∏—é)

–ü–æ–¥—Ä–æ–±–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è: [TILED_MAP_IMPLEMENTATION.md](TILED_MAP_IMPLEMENTATION.md)

## –ò—Å—Ç–æ—Ä–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π

### 2025-01-XX ‚Äî –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Tiled Map

**–î–æ–±–∞–≤–ª–µ–Ω–æ:**
- –ú–µ—Ç–æ–¥ `occupyTiledPortal()` –¥–ª—è —Ç–æ—á–Ω–æ–≥–æ —Ä–∞–∑–º–µ—â–µ–Ω–∏—è –ø–æ—Ä—Ç–∞–ª–æ–≤ –∏–∑ Tiled Map
- –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –∫–æ–ª–ª–∏–∑–∏–π –∏–∑ Tiled Map –≤ SpawnMatrix –∫–∞–∫ `'permanent'` —è—á–µ–π–∫–∏
- –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –ø–æ—Ä—Ç–∞–ª–æ–≤ —Ä–∞–∑–º–µ—Ä–æ–º 2√ó3 —è—á–µ–π–∫–∏ (–≤–º–µ—Å—Ç–æ 4√ó3 –¥–ª—è Random Spawn)

### 2025-12-08 ‚Äî –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–∑–∏—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è

**–ü—Ä–æ–±–ª–µ–º–∞:** –û–±—ä–µ–∫—Ç—ã —Ä–∞–∑–º–µ—â–∞–ª–∏—Å—å –≤ —Ü–µ–Ω—Ç—Ä–µ –æ–¥–Ω–æ–π —è—á–µ–π–∫–∏ –≤–Ω—É—Ç—Ä–∏ –±–ª–æ–∫–∞, –∞ –Ω–µ –≤ —Ü–µ–Ω—Ç—Ä–µ –≤—Å–µ–≥–æ –±–ª–æ–∫–∞, —á—Ç–æ –≤—ã–∑—ã–≤–∞–ª–æ —Å–º–µ—â–µ–Ω–∏–µ –Ω–∞ 16-32 –ø–∏–∫—Å–µ–ª—è –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω–æ –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏–∏.

**–†–µ—à–µ–Ω–∏–µ:** –ò–∑–º–µ–Ω–µ–Ω —Ä–∞—Å—á–µ—Ç —Ü–µ–Ω—Ç—Ä–∞ –±–ª–æ–∫–∞ –¥–ª—è –≤—Å–µ—Ö –æ–±—ä–µ–∫—Ç–æ–≤:
- –ü–æ—Ä—Ç–∞–ª—ã (4√ó3): –≤—ã—á–∏—Å–ª–µ–Ω–∏–µ —Ü–µ–Ω—Ç—Ä–∞ –±–ª–æ–∫–∞ –Ω–∞–ø—Ä—è–º—É—é
- –ö—É—Å—Ç—ã (2√ó2): –≤—ã—á–∏—Å–ª–µ–Ω–∏–µ —Ü–µ–Ω—Ç—Ä–∞ –±–ª–æ–∫–∞ –Ω–∞–ø—Ä—è–º—É—é
- –û—Ä–∞–∫—É–ª (2√ó4): –≤—ã—á–∏—Å–ª–µ–Ω–∏–µ —Ü–µ–Ω—Ç—Ä–∞ –±–ª–æ–∫–∞ –Ω–∞–ø—Ä—è–º—É—é

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** –û–±—ä–µ–∫—Ç—ã —Ç–µ–ø–µ—Ä—å —Ä–∞–∑–º–µ—â–∞—é—Ç—Å—è —Ç–æ—á–Ω–æ –≤ —Ü–µ–Ω—Ç—Ä–µ –±–ª–æ–∫–∞ —è—á–µ–µ–∫, –∫–æ—Ç–æ—Ä—ã–π –æ–Ω–∏ –∑–∞–Ω–∏–º–∞—é—Ç, —á—Ç–æ —Å–æ–≤–ø–∞–¥–∞–µ—Ç —Å –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏–µ–π –æ—Ç–ª–∞–¥–æ—á–Ω–æ–π —Å–µ—Ç–∫–∏.

---

**–°–≤—è–∑–∞–Ω–Ω—ã–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã:**
- `ProjectMap.md` ‚Äî –æ–±—â–∞—è –∫–∞—Ä—Ç–∞ –ø—Ä–æ–µ–∫—Ç–∞
- `ARCHITECTURE.md` ‚Äî –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Å–∏—Å—Ç–µ–º—ã
- `TILED_MAP_IMPLEMENTATION.md` ‚Äî —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è —É—Ä–æ–≤–Ω–µ–π —Å Tiled Map
- `src/game/systems/SpawnMatrix.ts` ‚Äî –∏—Å—Ö–æ–¥–Ω—ã–π –∫–æ–¥ –º–∞—Ç—Ä–∏—Ü—ã
- `src/game/systems/SpawnSystem.ts` ‚Äî –∏—Å—Ö–æ–¥–Ω—ã–π –∫–æ–¥ —Å–∏—Å—Ç–µ–º—ã —Å–ø–∞–≤–Ω–∞




