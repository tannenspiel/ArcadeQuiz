# ะกะฒะพะดะฝะฐั ัะฐะฑะปะธัะฐ: ะะฐัััั ัะฐะทะผะตัะฐ ััะธััะฐ ะฒ KeyQuestionModal

**ะะฐัะฐ:** 2026-02-12
**ะคะฐะนะป:** `src/game/ui/KeyQuestionModal.ts`

---

## ๐ ะะฑัะฐั ััะตะผะฐ ัะฐััััะฐ

```
                    โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
                    โ                                     โ
                    โ    calculateUnifiedBaseFontSize()       โ
                    โ             (ะฑะฐะทะพะฒัะน ัะฐะทะผะตั)            โ
                    โ                  โ                 โ
                    โ   โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ   โ
                    โ   โ                             โ   โ
                    โ   โ  ะะตััะพะฝ. ะผะฝะพะถะธัะตะปะธ         โ   โ
                    โ   โ  (ะดะปั ะบะฐะถะดะพะณะพ ัะปะตะผะตะฝัะฐ)    โ   โ
    โโโโโโโโโโโโโผโโโโโโโโโโโโโโโฌโโโโโโโโโโโโโโโผโโโโโโ   โ
    โ ะะพะฟัะพั    โ ะคะธะดะฑัะบ     โ   ะะฝะพะฟะบะธ    โ   โ
    โ 1.0ร     โ   1.0ร       โ   1.0ร      โ   โ
    โ           โ              โ              โ              โ              โ
    โโโโโโโโโโโโโดโโโโโโโโโโโโโโโดโโโโโโโโโโโโโโโดโโโโโโ   โ
    โ             โ               โ              โ              โ
                    โ                โ              โ
                    โ  commonFontSize =              โ
                    โ  Math.max(button, question)      โ
                    โ                                โ
                    โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
                    โ                    โ
                    โ  ะะดะฐะฟัะธะฒะฝัะน    โ
                    โ   ะผะฝะพะถะธัะตะปั   โ
                    โ  (aspect ratio)โ
                    โ                โ
                    โ                 โ
              getFontSizeMultiplier(screenAR)
```

---

## ๐ฏ ะญัะฐะฟ 1: ะะฐะทะพะฒัะน ัะฐัััั

### ะคัะฝะบัะธั: `calculateUnifiedBaseFontSize()`

**ะะฐะทะฝะฐัะตะฝะธะต:** ะะฐัััะธััะฒะฐะตั ะพะฟัะธะผะฐะปัะฝัะน ะฑะฐะทะพะฒัะน ัะฐะทะผะตั ััะธััะฐ, ะบะพัะพััะน ะฒะปะตะทะฐะตั ะฒ ะผะพะดะฐะปัะฝะพะต ะพะบะฝะพ.

**ะะฐัะฐะผะตััั:**
| ะะฐัะฐะผะตัั | ะขะธะฟ | ะะฟะธัะฐะฝะธะต |
|-----------|-----|-----------|
| `scene` | Phaser.Scene | ะกัะตะฝะฐ ะดะปั ัะพะทะดะฐะฝะธั ะฒัะตะผะตะฝะฝะพะณะพ ัะตะบััะพะฒะพะณะพ ะพะฑัะตะบัะฐ |
| `contentAreaWidth` | number | ะะพัััะฟะฝะฐั ัะธัะธะฝะฐ ะดะปั ะบะพะฝัะตะฝัะฐ (ะฒััะธัะปัะตััั ะทะฐัะฐะฝะตะต) |
| `contentAreaHeight` | number | ะะพัััะฟะฝะฐั ะฒััะพัะฐ ะดะปั ะบะพะฝัะตะฝัะฐ |
| `questionAreaHeight` | number | ะััะพัะฐ ะพะฑะปะฐััะธ ะฒะพะฟัะพัะฐ (ะฒััะธัะปัะตััั ะทะฐัะฐะฝะตะต) |
| `longestText.question` | string | ะกะฐะผัะน ะดะปะธะฝะฝัะน ัะตะบัั ะฒะพะฟัะพัะฐ |
| `baseFontSize` | number | ะขะตะบััะธะน ะฑะฐะทะพะฒัะน ัะฐะทะผะตั ััะธััะฐ (ะธะท `calculateOptimalBaseFontSize()`) |
| `level` | number | ะขะตะบััะธะน ััะพะฒะตะฝั (ะฟะพ ัะผะพะปัะฐะฝะธั 1) |
| `elementMultiplier` | number | ะะฝะพะถะธัะตะปั ะดะปั ัะธะฟะฐ ัะปะตะผะตะฝัะฐ (3 ะดะปั ะฒะพะฟัะพัะฐ/ัะธะดะฑัะบะฐ, 1 ะดะปั ะบะฝะพะฟะพะบ) |

**ะะพะทะฒัะฐัะฐะตั:** `number` โ ะพะฟัะธะผะฐะปัะฝัะน ะฑะฐะทะพะฒัะน ัะฐะทะผะตั ะฒ ะฟะธะบัะตะปัั

---

## ๐ฏ ะญัะฐะฟ 2: ะะฐัััั ัะฐะทะผะตัะฐ ะดะปั ะบะฐะถะดะพะณะพ ัะปะตะผะตะฝัะฐ

### ะะพะฟัะพั (Question)

**ะคัะฝะบัะธั:** `calculateBaseFontSize()`

**ะะฝะพะถะธัะตะปั:** `KEY_QUESTION_FONT_SIZE_MULTIPLIER = 1.0`

**ะััะธัะปะตะฝะธะต:**
```typescript
const questionFontSizeRaw = calculateBaseFontSize(
    this.scene,
    contentAreaWidth,        // ะะพัััะฟะฝะฐั ัะธัะธะฝะฐ ะดะปั ัะตะบััะฐ
    questionAreaHeight,       // ะััะพัะฐ ะพะฑะปะฐััะธ ะฒะพะฟัะพัะฐ
    longestTexts.question,    // ะกะฐะผัะน ะดะปะธะฝะฝัะน ัะตะบัั ะฒะพะฟัะพัะฐ
    baseFontSize,             // ะะฐะทะพะฒัะน ัะฐะทะผะตั (ะธะท ััะฐะฟะฐ 1)
    3                          // โ elementMultiplier
);
```

**ะคะธะฝะฐะปัะฝัะน ัะฐะทะผะตั:** `questionFontSizeRaw` (ะทะฐัะตะผ ะฟัะธะผะตะฝัะตััั ะฐะดะฐะฟัะธะฒะฝัะน ะผะฝะพะถะธัะตะปั)

---

### ะคะธะดะฑัะบ (Feedback)

**ะคัะฝะบัะธั:** `calculateBaseFontSize()`

**ะะฝะพะถะธัะตะปั:** `KEY_FEEDBACK_FONT_SIZE_MULTIPLIER = 1.0`

**ะััะธัะปะตะฝะธะต:**
```typescript
const feedbackFontSizeRaw = calculateBaseFontSize(
    this.scene,
    contentAreaWidth,
    feedbackAreaHeight,       // ะััะพัะฐ ะพะฑะปะฐััะธ ัะธะดะฑัะบะฐ = questionAreaHeight
    longestTexts.feedback,    // ะกะฐะผัะน ะดะปะธะฝะฝัะน ัะตะบัั ัะธะดะฑัะบะฐ
    baseFontSize,
    3                          // โ elementMultiplier
);
```

**ะคะธะฝะฐะปัะฝัะน ัะฐะทะผะตั:** `feedbackFontSizeRaw` (ะทะฐัะตะผ ะฟัะธะผะตะฝัะตััั ะฐะดะฐะฟัะธะฒะฝัะน ะผะฝะพะถะธัะตะปั)

---

### ะะฝะพะฟะบะธ (Buttons)

**ะคัะฝะบัะธั:** `calculateButtonFontSize()`

**ะะฝะพะถะธัะตะปั:** `KEY_BUTTON_FONT_SIZE_MULTIPLIER = 1.0`

**ะัะพะฑะตะฝะฝะพััะธ:**
- ะัะฟะพะปัะทัะตั `getButtonPadding()` ะดะปั ัะฐััััะฐ ะดะพัััะฟะฝะพะน ัะธัะธะฝั ั ััััะพะผ ะพััััะฟะพะฒ
- ะะตัะตะดะฐัั `buttonAvailableWidth` (ัะธัะธะฝะฐ ะผะธะฝัั ะพััััะฟั) ะฒะผะตััะพ ะฟะพะปะฝะพะน ัะธัะธะฝั ะบะฝะพะฟะบะธ
- ะัะธะผะตะฝัะตั ะดะพะฟะพะปะฝะธัะตะปัะฝัะต ะทะฐัะธัั ะพั ะฟะตัะตะฟะพะปะฝะตะฝะธั (debounce, ะฟัะพะฒะตัะบะฐ ะฒััะพัั)

**ะััะธัะปะตะฝะธะต:**
```typescript
const buttonPadding = getButtonPadding(buttonWidth, buttonHeight);
const buttonAvailableWidth = buttonPadding.availableWidth;
const buttonAvailableHeight = buttonPadding.availableHeight;

const buttonFontSizeRaw = calculateButtonFontSize(
    this.scene,
    buttonAvailableWidth,       // โ ะก ััััะพะผ ะพััััะฟะพะฒ!
    buttonAvailableHeight,
    longestTexts.answer,
    40,                        // defaultFontSize = MAX_OPTIMAL_FONT_SIZE
    3                           // โ elementMultiplier
);
```

**ะคะธะฝะฐะปัะฝัะน ัะฐะทะผะตั:** `buttonFontSizeRaw` (ะทะฐัะตะผ ะฟัะธะผะตะฝัะตััั ะฐะดะฐะฟัะธะฒะฝัะน ะผะฝะพะถะธัะตะปั)

---

## ๐ฏ ะญัะฐะฟ 3: ะฃะฝะธัะธะบะฐัะธั ะธ ะฐะดะฐะฟัะธะฒะฝัะน ะผะฝะพะถะธัะตะปั

### ะฃะฝะธัะธะบะฐัะธั ัะฐะทะผะตัะพะฒ

**ะคัะฝะบัะธั:** ะฒะฝัััะตะฝะฝัั ะปะพะณะธะบะฐ ะฒ `createUI()`

**ะะฐะทะฝะฐัะตะฝะธะต:** ะะฐัะฐะฝัะธััะตั, ััะพ ะฒัะต ัะตะบััะพะฒัะต ัะปะตะผะตะฝัั ะธะผะตัั ะพะดะธะฝะฐะบะพะฒัะน ัะฐะทะผะตั.

**ะะพะณะธะบะฐ:**
```typescript
// ะะฐัะพะดะธะผ ะผะธะฝะธะผะฐะปัะฝัะน ัะฐะทะผะตั, ะบะพัะพััะน ะฒะปะตะทะฐะตั ะฒะพ ะฒัะต ัะปะตะผะตะฝัั
let unifiedFontSize = Math.min(questionFontSizeRaw, feedbackFontSizeRaw);

// ะัะพะฒะตััะตะผ, ะฑัะป ะปะธ ะฟัะธะผะตะฝัะฝ clamp (ะทะฐัะธัะฐ ะพั ัะปะธัะบะพะผ ะผะฐะปัั/ะฑะพะปััะธั ัะฐะทะผะตัะพะฒ)
const baseFitsOverall = Math.abs(unifiedFontSize - baseFontSize) < 0.01;
const unifiedClamped = unifiedFontSize === MIN_FONT_SIZE_TEXT || unifiedFontSize === MAX_FONT_SIZE;
```

**ะะตะทัะปััะฐั:** `unifiedFontSize` โ ะตะดะธะฝัะน ัะฐะทะผะตั ะดะปั ะฒะพะฟัะพัะฐ ะธ ัะธะดะฑัะบะฐ

---

### ะะดะฐะฟัะธะฒะฝัะน ะผะฝะพะถะธัะตะปั

**ะคัะฝะบัะธั:** `getFontSizeMultiplier(screenAR)`

**ะะฐะทะฝะฐัะตะฝะธะต:** ะฃะฒะตะปะธัะธะฒะฐะตั ะธะปะธ ัะผะตะฝััะฐะตั ัะฐะทะผะตั ััะธััะฐ ะฒ ะทะฐะฒะธัะธะผะพััะธ ะพั aspect ratio ัะบัะฐะฝะฐ.

**ะะฝะพะถะธัะตะปะธ ะฟะพ ะดะธะฐะฟะฐะทะพะฝะฐะผ (ะธะท `textStyles.ts`):**

| ะะธะฐะฟะฐะทะพะฝ AR | ะะฐะทะฒะฐะฝะธะต | ะะฝะพะถะธัะตะปั | ะะฟะธัะฐะฝะธะต |
|--------------|----------|----------|-----------|
| < 0.25 | EXTRA_NARROW | 1.26 | ะญะบัััะตะผะฐะปัะฝะพ ัะทะบะธะต |
| 0.25 - 0.45 | MOBILE_NARROW | 1.34 | ะฃะทะบะธะต ะผะพะฑะธะปัะฝัะต |
| 0.45 - 0.60 | MOBILE_STANDARD | 1.41 | ะกัะฐะฝะดะฐััะฝัะต ะผะพะฑะธะปัะฝัะต |
| 0.60 - 0.75 | TABLET_SQUARE | 1.49 | ะะปะฐะฝัะตัั, ะบะฒะฐะดัะฐัะฝัะต |
| 0.75 - 0.85 | MONITOR_SMALL | 1.54 | ะะตะฑะพะปััะธะต ะผะพะฝะธัะพัั |
| 0.85 - 1.30 | MONITOR_LARGE | 1.45 | ะะพะปััะธะต ะผะพะฝะธัะพัั |
| โฅ 1.30 | ULTRA_WIDE | 1.35 | ะัะตะฝั ัะธัะพะบะธะต |

**ะคะพัะผัะปะฐ:**
```typescript
const screenAR = canvasWidth / canvasHeight;
const adaptiveMultiplier = getFontSizeMultiplier(screenAR);
```

---

## ๐ฏ ะญัะฐะฟ 4: ะคะธะฝะฐะปัะฝัะน ัะฐัััั ะดะปั ะฒัะตั ัะปะตะผะตะฝัะพะฒ

### ะะฑัะฐั ัะพัะผัะปะฐ

```typescript
// ะกะฝะฐัะฐะปะฐ ะฝะฐัะพะดะธะผ ะผะฐะบัะธะผะฐะปัะฝัะน ัะฐะทะผะตั ะธะท ะบะฝะพะฟะพะบ ะธ ะฒะพะฟัะพัะฐ
const commonFontSize = Math.max(buttonFontSizeRaw, unifiedFontSize);

// ะะฐัะตะผ ะฟัะธะผะตะฝัะตะผ ะฐะดะฐะฟัะธะฒะฝัะน ะผะฝะพะถะธัะตะปั ะดะปั aspect ratio
const questionFontSize = commonFontSize;     // = unifiedFontSize ร adaptiveMultiplier
const feedbackFontSize = commonFontSize;    // = unifiedFontSize ร adaptiveMultiplier
const buttonFontSize = commonFontSize;        // = buttonFontSizeRaw ร adaptiveMultiplier
```

**ะะฐะถะฝะพ:**
- `questionFontSize` ะธัะฟะพะปัะทัะตััั ะบะฐะบ ะดะปั ัะตะบััะฐ ะฒะพะฟัะพัะฐ, ัะฐะบ ะธ ัะฒะปัะตััั ะฑะฐะทะพะน ะดะปั ัะฝะธัะธะบะฐัะธะธ
- ะัะปะธ `questionFontSizeRaw` ะฑะพะปััะต `buttonFontSizeRaw`, ัะพ ะธัะฟะพะปัะทัะตััั `questionFontSize`
- ะัะปะธ `buttonFontSizeRaw` ะฑะพะปััะต `questionFontSizeRaw`, ัะพ ะธัะฟะพะปัะทัะตััั `buttonFontSize`

---

## ๐ ะะพะฝััะฐะฝัั ะผะฝะพะถะธัะตะปะตะน (ะธะท `textStyles.ts`)

```typescript
// KeyQuestionModal (ะบะปััะธ)
export const KEY_QUESTION_FONT_SIZE_MULTIPLIER = 1.0;
export const KEY_FEEDBACK_FONT_SIZE_MULTIPLIER = 1.0;
export const KEY_BUTTON_FONT_SIZE_MULTIPLIER = 1.0;

// CoinBubbleQuiz (ะผะพะฝะตัะบะธ) - ะดะปั ััะฐะฒะฝะตะฝะธั
export const COIN_QUESTION_FONT_SIZE_MULTIPLIER = 1.0;
export const COIN_BUTTON_FONT_SIZE_MULTIPLIER = 1.0;
```

---

## ๐ ะะพะปะฝัะน ัะธะบะป ัะฐััััะฐ

```
1. ะะฟัะตะดะตะปัะตััั aspect ratio ัะบัะฐะฝะฐ (screenAR)
   โ
2. ะะท FONT_SIZE_MULTIPLIERS ะฒัะฑะธัะฐะตััั ะฐะดะฐะฟัะธะฒะฝัะน ะผะฝะพะถะธัะตะปั
   โ
3. ะะปั ะบะฐะถะดะพะณะพ ัะปะตะผะตะฝัะฐ ะฒััะธัะปัะตััั ัะฒะพะน ัะฐะทะผะตั:
   - ะะพะฟัะพั: calculateBaseFontSize() ร 1.0
   - ะคะธะดะฑัะบ: calculateBaseFontSize() ร 1.0
   - ะะฝะพะฟะบะธ: calculateButtonFontSize() ร 1.0
   โ
4. ะะฟัะตะดะตะปัะตััั unifiedFontSize = Math.max(ะฒะพะฟัะพั, ัะธะดะฑัะบ)
   โ
5. ะคะธะฝะฐะปัะฝัะน ัะฐะทะผะตั ะบะฐะถะดะพะณะพ ัะปะตะผะตะฝัะฐ:
   - ะะพะฟัะพั: unifiedFontSize ร adaptiveMultiplier
   - ะคะธะดะฑัะบ: unifiedFontSize ร adaptiveMultiplier
   - ะะฝะพะฟะบะธ: Math.max(unified, ะบะฝะพะฟะบะฐ) ร adaptiveMultiplier
```

---

## โ ะัะพะฑะตะฝะฝะพััะธ ัะตะฐะปะธะทะฐัะธะธ

1. **Grid Snapping:** ะัะต ัะฐะทะผะตัั ะพะบััะณะปััััั ะดะพ ะทะฝะฐัะตะฝะธะน, ะบัะฐัะฝัั `BASE_SCALE = 4`
2. **ะะฐัะธัะฐ ะพั ะฟะตัะตะฟะพะปะฝะตะฝะธั:** ะัะพะฒะตััะตััั, ััะพ ัะตะบัั ะฝะต ะฟัะตะฒััะฐะตั ะฒััะพัั ะพะฑะปะฐััะธ
3. **ะะธะฝะฐัะฝัะน ะฟะพะธัะบ:** ะะปั `calculateOptimalBaseFontSize()` ะธัะฟะพะปัะทัะตััั ะดะฒะพะธัะฝัะน ะฟะพะธัะบ ะดะปั ะฝะฐัะพะถะดะตะฝะธั ะพะฟัะธะผะฐะปัะฝะพะณะพ ัะฐะทะผะตัะฐ
4. **Fallback ะทะฝะฐัะตะฝะธั:** ะัะปะธ QuizManager ะฝะตะดะพัััะฟะตะฝ, ะธัะฟะพะปัะทััััั ะดะตัะพะปัะฝัะต ัะตะบััั
5. **ะะธะฝะฐะผะธัะตัะบะธะต longest texts:** ะะพะปััะฐัััั ะธะท QuizManager ะดะปั ัะพัะฝะพะณะพ ัะฐััััะฐ ัะฐะทะผะตัะพะฒ
6. **ะะดะฐะฟัะธะฒะฝะพััั:** ะะฝะพะถะธัะตะปั aspect ratio ะฟัะธะผะตะฝัะตััั ะฝะฐ ัะธะฝะฐะปัะฝะพะผ ััะฐะฟะต ะบะพ ะฒัะตะผ ัะปะตะผะตะฝัะฐะผ

---

## ๐ ะะฐะฒะธัะธะผะพััะธ

- `textStyles.ts` โ ะฒัะต ะบะพะฝััะฐะฝัั ะผะฝะพะถะธัะตะปะตะน
- `ModalSizeCalculator.ts` โ ัะฐัััั ัะฐะทะผะตัะพะฒ ะผะพะดะฐะปัะฝะพะณะพ ะพะบะฝะฐ
- `PixelFontCalculator.ts` โ ัะฐัััั ะดะปั ะฟะธะบัะตะปัะฝัั ััะธััะพะฒ
- `QuizManager` โ ะฟัะตะดะพััะฐะฒะปัะตั ัะฐะผัะต ะดะปะธะฝะฝัะต ัะตะบััั

---

**ะกะพะทะดะฐะฝะพ:** 2026-02-12
**ะะฒัะพั:** Claude Code (ArcadeQuiz Documentation Analysis)
