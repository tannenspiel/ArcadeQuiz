---
trigger: always_on
---

# üß† Intelligent Prompt Analysis Rules

**Purpose:** –ê–Ω–∞–ª–∏–∑ –ø—Ä–æ–º–ø—Ç–æ–≤ –∏ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é —Å–ø–µ—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –∞–≥–µ–Ω—Ç–æ–≤.

---

## üìã Core Analysis Protocol

### **Step 1: Prompt Type Classification**
```typescript
function classifyPrompt(prompt: string): PromptAnalysis {
    const patterns = {
        documentation: ['–¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è', 'README', '–æ–±–Ω–æ–≤–∏—Ç—å', '—Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞—Ç—å', 'HISTORY', '–ø–ª–∞–Ω'],
        code_structure: ['–∞–Ω–∞–ª–∏–∑', '—Å—Ç—Ä—É–∫—Ç—É—Ä–∞', '–Ω–∞–π—Ç–∏', '–∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã', '–Ω–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–π –∫–æ–¥'],
        testing: ['—Ç–µ—Å—Ç', '–≤–∞–ª–∏–¥–∏—Ä–æ–≤–∞—Ç—å', '–ø–æ–∫—Ä—ã—Ç–∏–µ', '–ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å', 'npm test'],
        phaser: ['MainScene', '—Å—Ü–µ–Ω–∞', 'Phaser', '–æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è', '–∞–Ω–∏–º–∞—Ü–∏—è', '—Å–ø—Ä–∞–π—Ç'],
        ui: ['–º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ', '–∫–Ω–æ–ø–∫–∏', '–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å', 'UI', '–º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ', '–º–æ–¥–∞–ª–∫–∞'],
        complex: ['–∫–æ–º–ø–ª–µ–∫—Å–Ω—ã–π', '–Ω–µ—Å–∫–æ–ª—å–∫–æ', '–≤–µ—Å—å –ø—Ä–æ–µ–∫—Ç', '—Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥']
    };

    return {
        type: identifyType(prompt, patterns),
        complexity: assessComplexity(prompt),
        agents: selectOptimalAgents(prompt),
        benefits: calculateBenefits(prompt)
    };
}
```

### **Step 2: Agent Selection Logic**
```typescript
const agentSelectionMatrix = {
    'documentation': {
        primary: '@docs',
        secondary: '@explorer',
        efficiency: 0.95,
        reasoning: '–°–ø–µ—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–∞—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏'
    },
    'code_structure': {
        primary: '@explorer',
        secondary: '@docs',
        efficiency: 0.90,
        reasoning: '–≠–∫—Å–ø–µ—Ä—Ç–Ω—ã–π –∞–Ω–∞–ª–∏–∑ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –∫–æ–¥–∞'
    },
    'testing': {
        primary: '@tester',
        secondary: '@explorer',
        efficiency: 0.85,
        reasoning: '–°–ø–µ—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –≤–∞–ª–∏–¥–∞—Ü–∏—è –∏ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ'
    },
    'phaser': {
        primary: '@phaser',
        secondary: '@ui',
        efficiency: 0.95,
        reasoning: '–ì–ª—É–±–æ–∫–∞—è —ç–∫—Å–ø–µ—Ä—Ç–∏–∑–∞ –≤ Phaser 3 –∏ –∏–≥—Ä–æ–≤–æ–π –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–µ'
    },
    'ui': {
        primary: '@ui',
        secondary: '@phaser',
        efficiency: 0.90,
        reasoning: '–°–ø–µ—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ UI –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è'
    }
};
```

---

## üéØ Response Templates

### **Template 1: –î–ª—è –º–Ω–æ–≥–æ—à–∞–≥–æ–≤—ã—Ö –∑–∞–¥–∞—á**
```
üöÄ –ú–ù–û–ì–û–®–ê–ì–û–í–ê–Ø –ó–ê–î–ê–ß–ê

üìä –ê–ù–ê–õ–ò–ó –ó–ê–î–ê–ß–ò:
- –¢–∏–ø: {taskType}
- –°–ª–æ–∂–Ω–æ—Å—Ç—å: {complexity}
- –û–ø—Ç–∏–º–∞–ª—å–Ω—ã–µ –∞–≥–µ–Ω—Ç—ã: {agents}

üéØ –í–´–ë–†–ê–ù–ù–´–ï –ê–ì–ï–ù–¢–´: {selectedAgents}
üìã –ü–õ–ê–ù –í–´–ü–û–õ–ù–ï–ù–ò–Ø:
{executionPlan}

‚úÖ –í–´–ü–û–õ–ù–ï–ù–ò–ï –ù–ê–ß–ê–¢–û...
```

### **Template 2: –î–ª—è —Å–ª–æ–∂–Ω—ã—Ö —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥–æ–≤**
```
üß† –†–ï–ö–û–ú–ï–ù–î–ê–¶–ò–Ø –ü–û –ê–ì–ï–ù–¢–ê–ú

üìä –ê–ù–ê–õ–ò–ó –ó–ê–î–ê–ß–ò:
- –¢–∏–ø: {taskType}
- –°–ª–æ–∂–Ω–æ—Å—Ç—å: {complexity}

üéØ –û–ü–¢–ò–ú–ê–õ–¨–ù–´–ï –ê–ì–ï–ù–¢–´: {recommendedAgents}
üìà –°–†–ê–í–ù–ï–ù–ò–ï –≠–§–§–ï–ö–¢–ò–í–ù–û–°–¢–ò:
- –£–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã–π –ø–æ–¥—Ö–æ–¥: {efficiencyWithout}%
- –° —Å—É–±–∞–≥–µ–Ω—Ç–∞–º–∏: {efficiencyWith}%

üí° –ü–†–ï–ò–ú–£–©–ï–°–¢–í–ê –ê–ì–ï–ù–¢–û–í:
{benefitsList}

ü§î –í–ê–†–ò–ê–ù–¢–´:
1. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å Skill "superpowers:subagent-driven-development"
2. –í—ã–ø–æ–ª–Ω–∏—Ç—å –Ω–∞–ø—Ä—è–º—É—é (–º–µ–Ω–µ–µ —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ –¥–ª—è —Å–ª–æ–∂–Ω—ã—Ö –∑–∞–¥–∞—á)
```

---

## üìä Efficiency Calculations

### **Base Efficiency Matrix:**
```typescript
const baseEfficiency = {
    'universal': 0.70,      // –ë–∞–∑–æ–≤–∞—è —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å –±–µ–∑ –∞–≥–µ–Ω—Ç–æ–≤
    'docs': 0.95,            // +25% –¥–ª—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏
    'explorer': 0.90,        // +20% –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã
    'tester': 0.85,          // +15% –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
    'phaser': 0.95,          // +25% –¥–ª—è Phaser
    'ui': 0.90               // +20% –¥–ª—è UI
};
```

### **Complexity Multipliers:**
```typescript
const complexityMultipliers = {
    'simple': 1.0,      // –ë–∞–∑–æ–≤–∞—è —Å–ª–æ–∂–Ω–æ—Å—Ç—å
    'medium': 0.9,      // -10% –¥–ª—è —Å—Ä–µ–¥–Ω–∏—Ö –∑–∞–¥–∞—á
    'complex': 0.8,     // -20% –¥–ª—è —Å–ª–æ–∂–Ω—ã—Ö –∑–∞–¥–∞—á
    'expert': 0.7       // -30% –¥–ª—è —ç–∫—Å–ø–µ—Ä—Ç–Ω—ã—Ö –∑–∞–¥–∞—á
};
```

---

## üîÑ Decision Flow

### **Flow 1: Multi-step Task Detection**
```
START ‚Üí Check task complexity
         ‚Üì
    [3+ steps] ‚Üí Suggest subagent system ‚Üí Use Skill tool
         ‚Üì
    [Simple] ‚Üí Execute directly
```

### **Flow 2: Agent Selection**
```
START ‚Üí Analyze task type
         ‚Üì
    Identify patterns ‚Üí Select optimal agent(s)
         ‚Üì
    Create execution plan ‚Üí Execute or recommend
```

---

## üîç Pattern Matching

### **Documentation Patterns:**
- "–û–±–Ω–æ–≤–∏ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é"
- "–°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä—É–π PROJECT_MAP"
- "–û–±–Ω–æ–≤–∏ HISTORY.md"
- "–û–±–Ω–æ–≤–∏ README"

### **Code Structure Patterns:**
- "–ù–∞–π–¥–∏ –Ω–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–π –∫–æ–¥"
- "–ü—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä—É–π —Å—Ç—Ä—É–∫—Ç—É—Ä—É"
- "–ü—Ä–æ–≤–µ—Ä—å —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ –∫–æ–¥–∞ –∏ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏"

### **Testing Patterns:**
- "–ó–∞–ø—É—Å—Ç–∏ —Ç–µ—Å—Ç—ã"
- "–ü—Ä–æ–≤–µ—Ä—å –ø–æ–∫—Ä—ã—Ç–∏–µ"
- "–í–∞–ª–∏–¥–∏—Ä—É–π –∏–∑–º–µ–Ω–µ–Ω–∏—è"

### **Phaser Patterns:**
- "–û–ø—Ç–∏–º–∏–∑–∏—Ä—É–π MainScene"
- "–†–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥ –∏–≥—Ä–æ–≤—ã—Ö —Å–∏—Å—Ç–µ–º"
- "–ü—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä—É–π –∞–Ω–∏–º–∞—Ü–∏—é"

### **UI Patterns:**
- "–ú–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ"
- "–ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ"
- "–ê–¥–∞–ø—Ç–∏–≤–Ω—ã–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å"

---

## üí° When to Use Agents

### **‚úÖ –†–ï–ö–û–ú–ï–ù–î–£–ï–¢–°–Ø –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∞–≥–µ–Ω—Ç—ã:**

1. **–ú–Ω–æ–≥–æ—à–∞–≥–æ–≤—ã–µ –∑–∞–¥–∞—á–∏** (3+ —à–∞–≥–æ–≤)
   - –†–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥ –∫—Ä—É–ø–Ω—ã—Ö –º–æ–¥—É–ª–µ–π
   - –°–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤—ã—Ö —Ñ–∏—á
   - –ö–æ–º–ø–ª–µ–∫—Å–Ω—ã–π –∞–Ω–∞–ª–∏–∑

2. **–°–ª–æ–∂–Ω—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è**
   - –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è
   - –ö—Ä–æ—Å—Å-–¥–æ–º–µ–Ω–Ω—ã–µ –∑–∞–¥–∞—á–∏
   - –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –Ω–æ–≤—ã—Ö —Å–∏—Å—Ç–µ–º

3. **–°–ø–µ—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∑–∞–¥–∞—á–∏**
   - –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è ‚Üí @docs
   - –¢–µ—Å—Ç—ã ‚Üí @tester
   - Phaser ‚Üí @phaser
   - UI ‚Üí @ui
   - –ê–Ω–∞–ª–∏–∑ ‚Üí @explorer

### **‚ùå –ù–ï —Ç—Ä–µ–±—É–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –∞–≥–µ–Ω—Ç–æ–≤:**

1. **–ü—Ä–æ—Å—Ç—ã–µ –∑–∞–¥–∞—á–∏** (1-2 —à–∞–≥–∞)
   - –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –±–∞–≥–∞
   - –ù–µ–±–æ–ª—å—à–æ–µ –∏–∑–º–µ–Ω–µ–Ω–∏–µ
   - –ß—Ç–µ–Ω–∏–µ —Ñ–∞–π–ª–∞

2. **–û–¥–Ω–æ—Ä–∞–∑–æ–≤—ã–µ –¥–µ–π—Å—Ç–≤–∏—è**
   - –°–æ–∑–¥–∞–Ω–∏–µ —Ñ–∞–π–ª–∞
   - –ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤
   - –ü—Ä–æ—Å—Ç–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞

---

**–°–≤—è–∑–∞–Ω–Ω—ã–µ –ø—Ä–∞–≤–∏–ª–∞:**
- [04-agents.md](04-agents.md) - —Å–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏—è –∞–≥–µ–Ω—Ç–æ–≤
- [00-main-rules.md](00-main-rules.md) - –±–∞–∑–æ–≤—ã–µ –ø—Ä–∞–≤–∏–ª–∞
- [01-code-rules.md](01-code-rules.md) - –ø—Ä–∞–≤–∏–ª–∞ —Ä–∞–±–æ—Ç—ã —Å –∫–æ–¥–æ–º
