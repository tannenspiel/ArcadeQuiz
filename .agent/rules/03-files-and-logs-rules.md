# Правила работы с файлами и логами - ArcadeQuiz

**Файл:** `03-files-and-logs-rules.md`
**Назначение:** Правила работы с временными файлами, логами и порядком в проекте

---

## Структура папок для временных файлов

### `.temp/` - Временные файлы проекта

**Назначение:** Папка для временных файлов, создаваемых в процессе работы.

**Что хранить:**
- Временные тестовые выводы (test_output, etc)
- Временные скрипты и эксперименты
- Черновики кода
- Временные данные для отладки

**Правила:**
- `.temp/` исключён из Git (см. `.gitignore`)
- LLM должен создавать временные файлы в этой папке, а не в корне
- Файлы в `.temp/` можно удалять без подтверждения
- Регулярно очищать эту папку

### `documentation/temp_docs/` - Временная документация и логи

**Назначение:** Временные отчёты и логи для анализа.

**Что хранить:**
- **Логи игры** (`*.log` файлы) - логи для анализа работы модальных окон, масштабирования и других систем
- Отчёты о выполненных работах
- Промежуточные документы
- Черновики и заметки

**Правила:**
- `.log` файлы разрешены ТОЛЬКО в этой папке
- Папка доступна для чтения LLM всегда
- Логи должны иметь понятные имена (например, `localhost-modal-test-2025-01-13.log`)

---

## Работа с логами

### Где создавать лог-файлы

✅ **Правильно:**
- `documentation/temp_docs/game-log-2025-01-13.log`
- `documentation/temp_docs/modal-scaling-analysis.log`
- `documentation/temp_docs/localhost-*.log`

❌ **Неправильно:**
- `game.log` в корне проекта
- `temp_errors.log` в корне проекта
- Любые `.log` файлы вне `documentation/temp_docs/`

### Формат имени лог-файлов

Рекомендуемый формат:
```
<тип>-<описание>-<дата>.log
```

Примеры:
- `game-portal-test-2025-01-13.log`
- `ui-modal-scaling-2025-01-13.log`
- `localhost-phaser-debug-2025-01-13.log`

---

## Временные файлы Claude Code

### `tmpclaude-*-cwd` файлы

**Назначение:** Файлы создаются Claude Code для отслеживания текущей рабочей директории.

**Особенности:**
- Создаются автоматически при запуске Claude Code
- Содержат путь к проекту
- Не подлежат настройке - это внутренний механизм Claude Code

**Управление:**
- Файлы исключены из Git (`.gitignore`)
- Могут накапливаться в корне проекта
- Рекомендуется периодически удалять старые файлы

---

## Чек-лист перед сохранением временных файлов

Перед созданием любого временного файла в корне проекта:

- [ ] Можно ли сохранить этот файл в `.temp/`?
- [ ] Можно ли сохранить этот файл в `documentation/temp_docs/`?
- [ ] Действительно ли этот файл нужен в будущем?

Если ответ на все вопросы "НЕТ" - не создавайте файл в корне.

---

## ПРАВИЛА ДЛЯ КОДА С ЛОГИРОВАНИЕМ

**КРИТИЧЕСКИ ВАЖНО:** При создании кода (скриптов, тестов, утилит), который пишет логи или создаёт файлы, **ВСЕГДА** учитывайте расположение скрипта.

### Проблема `__dirname` в скриптах

Если скрипт находится в `scripts/`, то `__dirname` указывает на `scripts/`, а не на корень проекта.

**❌ НЕПРАВИЛЬНО:**
```javascript
// В файле scripts/my-script.js
const logPath = path.join(__dirname, 'documentation/temp_docs/log.txt');
// Результат: scripts/documentation/temp_docs/log.txt - ошибка!
```

**✅ ПРАВИЛЬНО:**
```javascript
// В файле scripts/my-script.js
const projectRoot = path.resolve(__dirname, '..');
const logPath = path.join(projectRoot, 'documentation/temp_docs/log.txt');
// Результат: documentation/temp_docs/log.txt - верно!
```

### Шаблон для скриптов в `scripts/`

```javascript
import path from 'path';
import { fileURLToPath } from 'url';

const __filename = fileURLToPath(import.meta.url);
const __dirname = path.dirname(__filename);
const projectRoot = path.resolve(__dirname, '..');  // ← ВСЕГДА добавляйте это!

// Теперь используйте projectRoot для всех путей
const logPath = path.join(projectRoot, 'documentation/temp_docs/log.txt');
const configPath = path.join(projectRoot, '.env');
```

### Чек-лист при создании кода с файловыми операциями

Перед тем как написать код, создающий файлы:

1. **Где будет находиться скрипт?**
   - В корне проекта → используйте `__dirname`
   - В `scripts/` → используйте `path.resolve(__dirname, '..')`

2. **Куда будут писаться логи?**
   - Логи тестов → `documentation/temp_docs/TEST_*.log`
   - Временные файлы → `.temp/`
   - ❌ Никогда → корень проекта

3. **Проверить путь:**
   - Относительный путь берётся от **текущей директории запуска**
   - Абсолютный путь с `__dirname` берётся от **директории скрипта**

---

**Связанные правила:**
- [00-main-rules.mdc](00-main-rules.mdc) - базовые правила и навигация
- [02-docs-rules.mdc](02-docs-rules.mdc) - правила ведения документации
